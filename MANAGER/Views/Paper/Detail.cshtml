
@{
    //ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    BLL.Authen.LoginRepo.User u = (BLL.Authen.LoginRepo.User)Session["User"];
}
<style>
</style>
<div class="card card-custom gutter-b">
    <div class="card-body">
        <h3 class="mb-10 font-weight-bold text-dark">Thông tin bài báo</h3>
        <div class="row">
            <div class="col-xl-6 form-group">
                <label>Tên bài báo</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.name" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Thời gian xuất bản</label>
                @{
                    if (ViewBag.paper.publish_date != null)
                    {
                        <input class="form-control form-control-lg custom-pickdate" type="text" value="@ViewBag.paper.publish_date.ToString("MM/yyyy")" disabled />
                    }
                    else
                    {
                        <input class="form-control form-control-lg custom-pickdate" type="text" value="" disabled />
                    }
                }
            </div>
            <div class="col-xl-6 form-group">
                <label>Link public toàn văn</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.link_doi" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Link scholar</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.link_scholar" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Loại ấn phẩm</label>
                <select class="form-control form-control-lg" id="paper_type" disabled>
                    @{
                        foreach (var item in ViewBag.type)
                        {
                            <option value="@item.paper_type_id">@item.name</option>
                        }
                    }
                </select>
            </div>
            <div class="col-xl-6 form-group">
                <label>Chuyên nghành</label>
                <select class="form-control form-control-lg" id="spec" disabled>
                    @{
                        foreach (var item in ViewBag.spec)
                        {
                            <option value="@item.specialization_id">@item.name</option>
                        }
                    }
                </select>
            </div>
        </div>

        <h3 class="mb-10 font-weight-bold text-dark">Thông tin nhà xuất bản</h3>
        <div class="row">
            <div class="col-xl-6 form-group">
                <label>Tên tạp chí</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.journal_name" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Tập</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.vol" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Trang</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.page" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Nhà xuất bản</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.company" disabled />
            </div>
        </div>

        <h3 class="mb-10 font-weight-bold text-dark">Thông tin xét thưởng</h3>
        <div class="row" id="thuong">
            <div class="col-xl-6 form-group">
                <label>Loại tiêu chí</label>
                <select id="loaithuong" class="form-control form-control-lg" disabled>
                    <option value="2">Quốc tế</option>
                    <option value="1">Trong nước</option>
                </select>
            </div>
            <div class="col-xl-6 form-group thuongtn" style="display: none">
                <label>Chỉ số tạp chí</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.index" disabled />
            </div>
            <div class="col-xl-6 form-group thuongtn" style="display: none">
                <label>File chứng minh</label>
                <a href="@ViewBag.paper.link_file" target="_blank" class="btn btn-light-primary px-6 font-weight-bold btn-sm form-control">View</a>
            </div>
            <div class="col-xl-6 form-group thuongtn" style="display: none">
                <label>Ghi chú</label>
                <input class="form-control form-control-lg" type="text" value="@ViewBag.paper.note_domestic" disabled />
            </div>
            <div class="col-xl-6 form-group">
                <label>Loại khen thưởng</label>
                <select id="typereward" class="form-control form-control-lg" disabled>
                    <option value="2">Theo quy định</option>
                    <option value="1">Đại diện nhận thưởng</option>
                </select>
            </div>
            <div class="col-xl-6 form-group">
                <label>Tổng thưởng</label>
                <input autocomplete="off" oninput="numberWithCommas(this)" id="totalreward" class="form-control form-control-lg edit" type="text" value="@ViewBag.paper.total_reward" />
            </div>
            <div class="col-xl-6 form-group" id="daidien_block">
                <label>Đại diện nhận thưởng</label>
                <input id="daidien" class="form-control form-control-lg edit" type="text" value="@ViewBag.p.name" disabled />
            </div>
            <h3 class="mb-10 font-weight-bold text-dark col-12">Thông tin tiêu chí</h3>
            <div class="col-xl-12 datatable datatable-bordered datatable-head-custom datatable-default datatable-primary datatable-loaded" id="kt_datatable" style="">
                <table class="custom-add-table table table-bordered">
                    <thead>
                        <tr>
                            <th>Tiêu chí</th>
                            <th>Đường dẫn</th>
                            <th>Duyệt</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.crite.Count == 0)
                        {
                            <tr>
                                <td colspan="3" class="justify-content-center text-muted text-center">Không có tiêu chí nào</td>
                            </tr>
                        }
                        @{
                            foreach (var item in ViewBag.crite)
                            {
                                <tr>
                                    <td>
                                        @item.name
                                    </td>
                                    <td>
                                        @if (item.check == true)
                                        {
                                            <a href="@item.link" target="_blank">@(item.link.Length > 80 ? item.link.Substring(0, 80) + "..." : item.link) </a> <i class='flaticon2-check-mark icon-nm' style="color:#99f5a4"></i>
                                        }
                                        else
                                        {
                                            <a href="@item.link" target="_blank">@(item.link.Length > 80 ? item.link.Substring(0, 80) + "..." : item.link) </a> <i class='flaticon2-delete icon-nm' style="color:#f59999"></i>
                                        }
                                    </td>
                                    @*<td>
                                            @if (item.check == true)
                                            {
                                            <span class='col-xl-1'><a target="_blank" href="@item.link" class='form-control form-control-lg font-weight-bold edit btn deletetieuchi'><i class="fas fa-eye"></i></a></span>
                                            }
                                            else
                                            {
                                            <span class='col-xl-1'><a target="_blank" href="@item.link" class='form-control form-control-lg font-weight-bold edit btn deletetieuchi'><i class="fas fa-eye"></i></a></span>
                                            }
                                        </td>*@
                                    <td>
                                        @if (item.manager_check != null && item.manager_check)
                                        {
                                            <a name="1" onclick="" class="btn btn-sm btn-clean btn-icon manager_check" title="View"> <i class="fa fas fa-check-circle icon-md" style="color:#62c700"></i> </a>
                                            @*<span class='col-xl-1 manager_check' name="1"><a class='form-control form-control-lg edit btn' style="background-color: lawngreen; border-color: lawngreen"><i class='flaticon2-checkmark' style="color:black"></i></a></span>*@
                                        }
                                        else
                                        {
                                            <a name="0" onclick="" class="btn btn-sm btn-clean btn-icon manager_check" title="View"> <i class="fa fas fa-check-circle icon-md"></i> </a>
                                            @*<span class='col-xl-1 manager_check' name="0"><a class='form-control form-control-lg edit btn' style="background-color: red; border-color: red"><i class='flaticon2-delete' style="color:black"></i></a></span>*@
                                        }
                                    </td>
                                </tr>
                                @*<div class='col-xl-12 d-flex justify-content-center onetieuchi' style="margin-top: 1rem">
                                        <span class='col-xl-2'><input readonly value="@item.name" class='form-control form-control-lg edit tieuchiname' name='tieuchiname' type='text' /></span>
                                        <span class='col-xl-8'><input placeholder='Link' class='form-control form-control-lg edit tieuchilink' type='text' value="@item.link" /></span>
                                        @if (item.check == true)
                                        {
                                            <span class='col-xl-1'><a target="_blank" href="@item.link" class='form-control form-control-lg  font-weight-bold edit btn deletetieuchi'><i class="fa fas fa-check-circle icon-md"></i></a></span>
                                        }
                                        else
                                        {
                                            <span class='col-xl-1'><a target="_blank" href="@item.link" class='form-control form-control-lg font-weight-bold edit btn deletetieuchi'><i class="fas fa-eye"></i></a></span>
                                        }
                                        @if (item.manager_check)
                                        {
                                            <span class='col-xl-1 manager_check' name="1"><a class='form-control form-control-lg font-weight-bold edit btn deletetieuchi'><i class="fa fas fa-check-circle icon-md"></i></a></span>
                                        }
                                        else
                                        {
                                            <span class='col-xl-1 manager_check' name="0"><a class='form-control form-control-lg font-weight-bold edit btn deletetieuchi'><i class="fa fas fa-check-circle icon-md"></i></a></span>
                                        }

                                    </div>*@
                            }
                        }
                    </tbody>
                </table>
            </div>
            @{

                if (ViewBag.paper.status_id == 3 || ViewBag.paper.status_id == 8)
                {
                    if (ViewBag.acc.role_id == 2 && ViewBag.paper.type == "2")
                    {
                        <div class="col-xl-12">
                            <a @*onclick="gatCriteria(@ViewBag.paper.paper_id)"*@ class="btn btn-light-primary" id="edit_criteria" data-toggle="modal" data-target="#editCriteria">Chỉnh sửa tiêu chí</a>
                        </div>
                    }
                }
            }

        </div>
        <h3 class="mb-10 font-weight-bold text-dark mt-10">Thông tin tác giả</h3>
        <div class="row" id="authors-info-container">
            @{
                foreach (var item in ViewBag.author)
                {
                    <div class="col-lg-4 col-sm-12">
                        <!--begin::Card-->
                        <div class="card card-custom gutter-b author-info-card" id="@item.people_id">
                            <div class="card-header">
                                <div class="card-title">
                                    @if (item.mssv_msnv != null)
                                    {
                                        <h3 id="author_name" class="card-label">@item.mssv_msnv - @item.name</h3>
                                    }
                                    else
                                    {
                                        <h3 id="author_name" class="card-label">@item.name</h3>
                                    }
                                </div>
                                <div class="card-toolbar">
                                    @if (item.mssv_msnv != null)
                                    {
                                        <a data-id="@item.people_id" class="edit-author-reward btn btn-icon btn-sm btn-hover-light-danger" data-toggle="modal" data-target="#editOneReward">
                                            <i class="far fa-edit"></i>
                                        </a>
                                    }
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-12 col-sm-12 col-md-12">
                                        <div class="mb-7">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Khu Vực:</span>
                                                <span class="text-muted font-weight-bold">@item.office_abbreviation</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Chức danh:</span>
                                                <a href="#" class="text-muted text-hover-primary">@item.title_string</a>
                                            </div>
                                            @*<div class="d-flex justify-content-between align-items-cente my-1">
                                                    <span class="text-dark-75 font-weight-bolder mr-2">Loại hợp đồng:</span>
                                                    <a href="#" class="text-muted text-hover-primary">@item.contract_name</a>
                                                </div>*@
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Mã số thuế: </span>
                                                <a href="#" class="text-muted text-hover-primary">@item.tax_code</a>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Email:</span>
                                                <span class="text-muted font-weight-bold">@item.email</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">CMND số:</span>
                                                <a href="#" class="text-muted text-hover-primary">@item.identification_number</a>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">CMND link:</span>
                                                <a href="@item.identification_file_link" class="text-muted text-hover-primary">
                                                    @(item.identification_file_link!=null?(item.identification_file_link.Length>30? item.identification_file_link.Substring(0,30)+"...": item.identification_file_link):"")
                                                </a>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Ngân hàng: </span>
                                                <a href="#" class="text-muted text-hover-primary">@item.bank_branch</a>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Số tài khoản: </span>
                                                <a href="#" class="text-muted text-hover-primary">@item.bank_number</a>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-cente my-1">
                                                <span class="text-dark-75 font-weight-bolder mr-2">Tiền thưởng: </span>
                                                @{
                                                    if (item.office_abbreviation == null)
                                                    {

                                                        <a href="#" class="text-muted text-hover-primary" id="tacgia_reward">@item.money_reward</a>

                                                    }
                                                    else
                                                    {

                                                        <a href="#" class="text-muted text-hover-primary onereward_text" name="@item.people_id" id="tacgia_reward">@item.money_reward</a>

                                                    }
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--end::Card-->
                    </div>
                }

            }
        </div>
        <hr />
        <div class="row justify-content-center">
            @{
                if (ViewBag.paper.status_id == 3 || ViewBag.paper.status_id == 8)
                {
                    if (u.rights.Contains(36))
                    {
                        <button class="btn btn-light-success px-6 font-weight-bold mx-1" id="confirmbtn">Xác nhận duyệt</button>
                    }
                    if (u.rights.Contains(35))
                    {
                        <button class="btn btn-light-warning px-6 font-weight-bold mx-1" id="editconfirm">Yêu cầu chỉnh sửa</button>
                    }
                    if (u.rights.Contains(39))
                    {
                        <button class="btn btn-light-danger px-6 font-weight-bold mx-1" id="deleteconfirm">Hủy yêu cầu</button>
                    }
                }
                else if (ViewBag.paper.status_id == 4)
                {
                    if (u.rights.Contains(35))
                    {
                        <button class="btn btn-light-warning px-6 font-weight-bold mx-1" id="editconfirm">Yêu cầu chỉnh sửa</button>
                    }
                    if (u.rights.Contains(38))
                    {
                        <button class="btn btn-light-warning px-6 font-weight-bold mx-1" id="editconfirm_manager">Yêu cầu xem lại</button>
                    }
                }
                else if (ViewBag.paper.status_id == 10)
                {
                    <button class="btn btn-light-success px-6 font-weight-bold mx-1" id="confirmbtn_rewardauthor">Xác nhận thưởng tác giả</button>
                    <button class="btn btn-light-warning px-6 font-weight-bold mx-1" id="editconfirm_rewardauthor">Yêu cầu chỉnh sửa thưởng tác giả</button>
                }
            }
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <!--begin::Mixed Widget 14-->
        <div class="card card-custom gutter-b card-stretch bgi-no-repeat">
            <div class="card-body">
                <h3 class="mb-10 font-weight-bold text-dark mt-10">Thông tin hội thoại</h3>
                <div>
                    @{
                        Html.RenderAction("Index", "CommentRequest", new { request_id = ViewBag.request_id });
                    }
                </div>
            </div>
            <!--end::Body-->
        </div>
        <!--end::Mixed Widget 14-->
    </div>
</div>

<div class="modal fade" id="editOneReward" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa thưởng cho tác giả</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xl-6">
                        <label>Tên tác giả</label>
                        <input class="form-control form-control-lg" id="name_tacgia" type="text" value="" disabled />
                    </div>
                    <div class="col-xl-6">
                        <label>Thưởng</label>
                        <input autocomplete="off" oninput="numberWithCommas(this)" class="form-control form-control-lg onereward" id="reward_tacgia" type="text" value="" />
                    </div>
                    <div class="justify-content-center col-xl-12 d-flex citationE" style="margin-top: 25px">
                        <button class="btn btn-light-primary px-6 font-weight-bold" id="add_author_save_edit" data-dismiss="modal">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editCriteria" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa tiêu chí cho bài báo</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xl-12 form-group">
                        <lable class="mb-10">Chọn tiêu chí</lable>
                        <select id="tieuchi" class="form-control col-xl-12" style="width: 100%">
                            @{
                                foreach (var item in ViewBag.listCriteria)
                                {
                                    <option class="optiontieuchi" value="@item.name">@item.name</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-xl-12 form-group">
                        <table id="cri_table" class="custom-add-table table table-bordered">
                            <tr>
                                <td>Tên tiêu chí</td>
                                <td>Đường dẫn</td>
                                <td></td>
                            </tr>
                            @{
                                foreach (var item in ViewBag.crite)
                                {
                                    <tr>
                                        <td><input autocomplete="off" type="text" value="@item.name" readonly class="form-control name_cri" /></td>
                                        <td><input autocomplete="off" type="text" value="@item.link" class="form-control link_cri" /></td>
                                        <td><a onclick='deleteRow(this)' class='btn btn-sm btn-clean btn-icon' title='Delete'> <i class='la la-trash'></i> </a></td>
                                    </tr>
                                }
                            }
                        </table>
                    </div>
                    <div class="col-xl-12">
                        <button class="btn btn-light-success float-right" id="confirm_edit_cri">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/Scripts/inputFilter.js"></script>
    <script>
        var people = [];
        var check = true;
        var id_people_selected;

        $(document).ready(function () {
            $("#tieuchi").select2({
                allowClear: true
            });
            $("#typereward").val("@ViewBag.paper.reward_type");
            $("#loaithuong").val("@ViewBag.paper.type");
            $("#spec").val("@ViewBag.paper.specialization_id");
            $("#paper_type").val("@ViewBag.paper.paper_type_id");

            var status = "@ViewBag.paper.status_id";
            if (status == "5") {
                $("#totalreward").prop("disabled", true);
                $(".edit-author-reward").prop('disabled', true);
            } else if (status == "4") {
                $("#totalreward").prop("disabled", true);
            }

            if ($("#loaithuong").val() == "1") {
                $(".thuongtn").show();
                $(".thuongqt").hide();
            }

            if ($("#typereward").val() == "2") $("#daidien_block").hide();
            else {
                $(".edit-author-reward").prop('disabled', true);
            }

            var x = $("#totalreward").val();
            $("#totalreward").val(x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));

            $(".onereward_text").each(function () {
                var x = $(this).text();
                $(this).text(x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
            });

            //$(".oneauthor").each(function () {
            //    var person = {
            //        people_id: this.id
            //    }
            //    people.push(person);
            //});
        });
        $(document).on("wheel", "input[type=number]", function (e) {
            $(this).blur();
        });

        $("#tieuchi").on("select2:select", function (e) {
            $("#cri_table").append('<tr>' +
                '<td><input autocomplete="off" type="text" class="form-control name_cri" value="' + $(this).val()+'"/></td>' +
                '<td><input autocomplete="off" type="text" class="form-control link_cri" /></td>' +
                '<td><a onclick="deleteRow(this)" class="btn btn-sm btn-clean btn-icon" title="Delete"> <i class="la la-trash"></i> </a></td>' +
                '</tr> ');
        });

        function deleteRow(el) {
            $(el).parents("tr").remove();
        }

        $("#confirm_edit_cri").click(function () {
            $("#loading").show();
            criteria = [];
            var inputs = $(".name_cri");
            var inputs2 = $(".link_cri");

            for (var i = 0; i < inputs.length; i++) {
                var PaperWithCriteria = {
                    link: $(inputs2[i]).val(),
                    name: $(inputs[i]).val()
                }
                if ($(inputs2[i]).val() == "") {
                    $("#loading").hide();
                    toastr.error("Tiêu chí chưa có link chứng minh");
                    check = false;
                    return false;
                }
                criteria.push(PaperWithCriteria);
            }

            var paper_id = "@ViewBag.paper.paper_id";
            $.ajax({
                url: "@Url.Action("editCriteria", "Paper")",
                type: "POST",
                data: JSON.stringify({ 'criteria': criteria, 'paper_id': paper_id }),
                contentType: "application/json;charset=utf-8",
                datatype: "json",
                cache: false,
                success: function (response) {
                    if (response.mess) {
                        $("#loading").hide();
                        window.location.reload();
                    }
                },
                error: function () {
                    //alert("fail");
                }
            });
        });

        $("#confirmbtn_rewardauthor").click(function () {
            $("#loading").show();
            var request_id = "@ViewBag.paper.request_id";
            $.ajax({
                url: "@Url.Action("confirmReqward", "Paper")",
                type: "POST",
                data: JSON.stringify({ 'request_id': request_id }),
                contentType: "application/json;charset=utf-8",
                datatype: "json",
                cache: false,
                success: function (response) {
                    if (response.mess) {
                        $("#loading").hide();
                        $("#editconfirm_rewardauthor").prop("disabled", true);
                        $("#confirmbtn_rewardauthor").prop("disabled", true);
                        //hub.server.send(response.mess);
                    }
                    else alert('loi');
                },
                error: function () {
                    //alert("fail");
                }
            });
        });

        $("#editconfirm_rewardauthor").click(function () {
            $("#loading").show();
            var request_id = "@ViewBag.paper.request_id";
            $.ajax({
                url: "@Url.Action("editAuthorReqward", "Paper")",
                type: "POST",
                data: JSON.stringify({ 'request_id': request_id }),
                contentType: "application/json;charset=utf-8",
                datatype: "json",
                cache: false,
                success: function (response) {
                    if (response.mess) {
                        $("#loading").hide();
                        $("#editconfirm_rewardauthor").prop("disabled", true);
                        $("#confirmbtn_rewardauthor").prop("disabled", true);
                        //hub.server.send(response.mess);
                    }
                    else alert('loi');
                },
                error: function () {
                    //alert("fail");
                }
            });
        });

        $("#editconfirm").click(function () {
            $("#loading").show();
            var paper_id = "@ViewBag.paper.paper_id";
            var request_id = "@ViewBag.paper.request_id";
            var paper = {
                paper_id: paper_id,
                request_id: request_id
            };
            $.ajax({
                url: "@Url.Action("changeStatus", "Paper")",
                type: "POST",
                data: JSON.stringify({ 'paper': paper }),
                contentType: "application/json;charset=utf-8",
                datatype: "json",
                cache: false,
                success: function (response) {
                    if (response.mess != "ff") {
                        $("#loading").hide();
                        $("#editconfirm").prop("disabled", true);
                        $("#confirmbtn").prop("disabled", true);
                        $("#totalreward").prop("disabled", true);
                        $("#deleteconfirm").prop("disabled", true);
                        hub.server.send(response.mess);
                        //editRequest();
                        //alert(response.mess);
                        //window.location.href = "/Paper/Pending";
                    }
                    else alert('loi');
                },
                error: function () {
                    //alert("fail");
                }
            });
        });

        $("#deleteconfirm").click(function () {
            Swal.fire({
                title: "Xác nhận hủy",
                text: "Hủy yêu cầu này?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.isConfirmed) {
                    $("#loading").show();
                    var request_id = "@ViewBag.request_id";
                    $.ajax({
                        url: "@Url.Action("DeleteRequest", "Paper")",
                        type: "POST",
                        data: JSON.stringify({ 'id': request_id }),
                        contentType: "application/json;charset=utf-8",
                        datatype: "json",
                        cache: false,
                        success: function (response) {
                            $("#loading").hide();
                            if (response.mess == "ss") {
                                $("#editconfirm").prop("disabled", true);
                                $("#confirmbtn").prop("disabled", true);
                                $("#totalreward").prop("disabled", true);
                                $("#deleteconfirm").prop("disabled", true);

                                toastr.success("Hủy yêu cầu thành công");
                                //$("#edit_modal_cri_name").val(response.pc);
                                $("#loading").hide();
                            }
                            else toastr.error("Hủy yêu cầu thất bại");
                        },
                        error: function () {
                            $("#loading").hide();
                            toastr.error("Hủy yêu cầu thất bại");
                            //alert("fail");
                        }
                    });
                }
            });
        });

        $("#editconfirm_manager").click(function () {
            $("#loading").show();
            var paper_id = "@ViewBag.paper.paper_id";
            var request_id = "@ViewBag.paper.request_id";
            var paper = {
                paper_id: paper_id,
                request_id: request_id
            };
            $.ajax({
                url: "@Url.Action("RequestReview", "Paper")",
                type: "POST",
                data: JSON.stringify({ 'paper': paper }),
                contentType: "application/json;charset=utf-8",
                datatype: "json",
                cache: false,
                success: function (response) {
                    if (response.mess == "ss") {
                        $("#loading").hide();
                        $("#editconfirm_manager").prop("disabled", true);
                        //editRequest();
                        //alert(response.mess);
                        //window.location.href = "/Paper/Pending";
                    }
                    else alert('loi');
                },
                error: function () {
                    //alert("fail");
                }
            });
        });

        $("#confirmbtn").click(function () {
            $("#loading").show();
            var ck = $("#typereward").val();
            var temp = $("#totalreward").val();
            if (temp == "" || temp == "0") {
                $("#loading").hide();
                toastr.error("Chưa điền thông tin tổng thưởng cho bài báo");
                check = false;
            } else {
                check = true;
                if (ck == "2") {
                    $(".onereward_text").each(function () {
                        var value = $(this).text();
                        //console.log(value);
                        if (value == "" || value == "0") {
                            $("#loading").hide();
                            toastr.error("Chưa điền đủ thông tin thưởng cho tác giả");
                            check = false;
                            return false;
                        } else {
                            check = true;
                        }
                    });
                }
            }

            if (check) {
                $(".manager_check").each(function () {
                    var val = $(this).attr("name");
                    if (val == "0") {
                        $("#loading").hide();
                        toastr.error("Chưa check hết các tiêu chí");
                        check = false;
                        return false;
                    } else {
                        check = true;
                    }
                })
            }


            //if (check) alert("abc");

            if (check) {
                people = [];
                var authors_reward = $(".onereward_text");
                for (var i = 0; i < authors_reward.length; i++) {
                    var person = {
                        people_id: $(authors_reward)[i].name,
                        money_string: $(authors_reward)[i].text
                    }
                    people.push(person);
                }

                var sum = 0;
                var total = $("#totalreward").val();
                total = total.split(",").join("");
                for (var i = 0; i < people.length; i++) {
                    if (people[i].money_string != null) {
                        var data = people[i].money_string;
                        var temp = data.split(",").join("");
                        sum = parseInt(sum) + parseInt(temp);
                    }
                }
                //console.log(sum, parseInt(total));
                if (sum > parseInt(total) && ck == "2") {
                    $("#loading").hide();
                    toastr.error("Tổng tiền thưởng tác giả quá tổng thưởng bài báo");
                } else if (sum < parseInt(total) && ck == "2") {
                    $("#loading").hide();
                    toastr.error("Tổng tiền thưởng tác giả chưa bằng tổng thưởng bài báo");
                } else {
                    var paper_id = "@ViewBag.paper.paper_id";
                    var request_id = "@ViewBag.paper.request_id";
                    var people_id = "@ViewBag.p.people_id";
                    var paper = {
                        paper_id: paper_id,
                        request_id: request_id,
                        total_reward: total,
                        reward_type: $("#typereward").val()
                    };
                    $.ajax({
                        url: "@Url.Action("ApprovePaper", "Paper")",
                        type: "POST",
                        data: JSON.stringify({ 'paper': paper, 'people': people, 'id': people_id }),
                        contentType: "application/json;charset=utf-8",
                        datatype: "json",
                        cache: false,
                        success: function (response) {
                            if (response.mess == "ss") {
                                //editRequest();
                                $("#loading").hide();
                                window.location.href = "/Paper/Pending";
                            }
                            else alert('loi');
                        },
                        error: function () {
                            //alert("fail");
                        }
                    });
                }
            }
        });

        $(".onereward, #totalreward").inputFilter(function (value) {
            return /^[0-9,.]*$/.test(value);
        });

        //$("#totalreward").change(function () {
        //    var x = $(this).val();
        //    $(this).val(x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
        //});

        //$(".onereward").change(function () {
        //    var x = $(this).val();
        //    $(this).val(x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
        //});

        $(".edit-author-reward").click(function () {
            id_people_selected = $(this).data("id");
            var x = document.getElementById(id_people_selected).querySelector("#author_name").innerHTML;
            var arr = x.split(' - ');
            if (arr.length == 2) $("#name_tacgia").val(arr[1]);
            else $("#name_tacgia").val(arr[0]);
            var y = document.getElementById(id_people_selected).querySelector("#tacgia_reward").innerHTML;
            $("#reward_tacgia").val(y);
            //console.log(arr);
        });

        $("#add_author_save_edit").click(function () {
            var val = $("#reward_tacgia").val();
            var x = document.getElementById(id_people_selected).querySelector("#tacgia_reward").innerHTML = val;
        });

        $(".manager_check").click(function () {
            var val = $(this).attr("name");
            if (val == "0") {
                $(this).attr("name", "1");
                $(this).empty();
                $(this).append("<a onclick='' class='btn btn-sm btn-clean btn-icon manager_check' title='View'> <i class='fa fas fa-check-circle icon-md' style='color: #62c700'></i> </a>");
            } else {
                $(this).attr("name", "0");
                $(this).empty();
                $(this).append("<a onclick='' class='btn btn-sm btn-clean btn-icon manager_check' title='View'> <i class='fa fas fa-check-circle icon-md'></i> </a>");
            }
            //alert(val);
        });

        function numberWithCommas(ele) {
            var x = $(ele).val().toString().replaceAll(",", "").replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            $(ele).val(x);
        }
    </script>
}