
@{
    ViewBag.Title = "Danh sách biên bản ghi nhớ";
    Layout = "~/Views/Shared/_Layout_InternationalCollaboration.cshtml";
}

<style>
    .custom-container {
        width: 100%;
        position: relative;
        z-index: 1;
    }

        .custom-container ul {
            padding-left: 12px;
        }

    li {
        text-decoration: none;
        list-style: none;
    }

    .progressbar li {
        float: left;
        width: 50%;
        position: relative;
        text-align: center;
    }

    .progressbar {
        counter-reset: step;
    }

        .progressbar li:before {
            content: counter(step);
            counter-increment: step;
            width: 50px;
            height: 50px;
            border: 2px solid #bebebe;
            display: block;
            margin: 0 auto 10px auto;
            border-radius: 50%;
            line-height: 44px;
            font-size: 19px;
            background: white;
            color: #bebebe;
            text-align: center;
            font-weight: bold;
        }

        .progressbar li:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 3px;
            background: #979797;
            top: 21px;
            left: -50%;
            z-index: -1;
        }

        .progressbar li:first-child:after {
            content: none;
        }

        .progressbar li.active::before {
            border-color: #3aac5d;
            color: #3aac5d;
        }

        .progressbar li.active + li:after {
            background: #8db398;
        }

        .progressbar li.done::before {
            border-color: #3aac5d;
            background: #3aac5d;
            color: white;
        }

        .progressbar li.done + li:after {
            background: #3aac5d;
        }
</style>
<style>
    #toast-container-custom {
        position: fixed;
        z-index: 999999;
        pointer-events: none;
    }

    .toast-bottom-left-custom {
        bottom: 12px;
        left: 12px;
    }

    #toast-container-custom * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
    }

    #toast-container-custom > div {
        position: relative;
        pointer-events: auto;
        overflow: hidden;
        margin: 0 0 6px;
        padding: 15px 15px 15px 50px;
        width: 300px;
        border-radius: 3px 3px 3px 3px;
        background-position: 15px center;
        background-repeat: no-repeat;
        -webkit-box-shadow: 0 0 12px #999999;
        box-shadow: 0 0 12px #999999;
        color: #FFFFFF;
        opacity: 0.8;
        -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);
        filter: alpha(opacity=80);
    }

        #toast-container-custom > div.rtl {
            direction: rtl;
            padding: 15px 50px 15px 15px;
            background-position: right 15px center;
        }

        #toast-container-custom > div:hover {
            -webkit-box-shadow: 0 0 12px #000000;
            box-shadow: 0 0 12px #000000;
            opacity: 1;
            -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);
            filter: alpha(opacity=100);
            cursor: pointer;
        }

    #toast-container-custom > .toast-warning {
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGYSURBVEhL5ZSvTsNQFMbXZGICMYGYmJhAQIJAICYQPAACiSDB8AiICQQJT4CqQEwgJvYASAQCiZiYmJhAIBATCARJy+9rTsldd8sKu1M0+dLb057v6/lbq/2rK0mS/TRNj9cWNAKPYIJII7gIxCcQ51cvqID+GIEX8ASG4B1bK5gIZFeQfoJdEXOfgX4QAQg7kH2A65yQ87lyxb27sggkAzAuFhbbg1K2kgCkB1bVwyIR9m2L7PRPIhDUIXgGtyKw575yz3lTNs6X4JXnjV+LKM/m3MydnTbtOKIjtz6VhCBq4vSm3ncdrD2lk0VgUXSVKjVDJXJzijW1RQdsU7F77He8u68koNZTz8Oz5yGa6J3H3lZ0xYgXBK2QymlWWA+RWnYhskLBv2vmE+hBMCtbA7KX5drWyRT/2JsqZ2IvfB9Y4bWDNMFbJRFmC9E74SoS0CqulwjkC0+5bpcV1CZ8NMej4pjy0U+doDQsGyo1hzVJttIjhQ7GnBtRFN1UarUlH8F3xict+HY07rEzoUGPlWcjRFRr4/gChZgc3ZL2d8oAAAAASUVORK5CYII=") !important;
    }
</style>
<style>
    .modal {
        overflow-y: auto;
    }

    .uppy-list-item {
        margin: 0 !important;
    }

    .select2-dropdown {
        z-index: 8888;
    }
</style>

<div class="card card-custom collapse_tab_1" id="main-card">
    <div class="card-body p-0 ">
        <div class="row justify-content-center px-8 my-lg-5 px-lg-10">
            <div class="col-xl-12 col-xxl-12">
                <div class="tabbable-line">
                    <div class="tab-content" id="myTabContent">
                        <div class="row">
                            <div class="col-lg-3 col-xl-3 col-md-3 col-sm-3">
                                <div class="row align-items-center">
                                    <div class="col-lg-offset-6 col-md-offset-6 col-sm-offset-6 my-1">
                                        <a href="#add_mou_modal" class="btn btn-light-primary px-6 font-weight-bold" data-toggle="modal">Thêm</a>
                                    </div>
                                    <div class="col-lg-offset-6 col-md-offset-6 col-sm-offset-6 my-1">
                                        <div class="dropdown dropdown-inline ml-2">
                                            <button type="button" class="btn btn-light-primary font-weight-bolder dropdown-toggle"
                                                    data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                Export
                                            </button>
                                            <!--begin::Dropdown Menu-->
                                            <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                                                <!--begin::Navigation-->
                                                <ul class="navi flex-column navi-hover py-2">
                                                    <li class="navi-header font-weight-bolder text-uppercase font-size-sm text-primary pb-2">
                                                        Choose an option:
                                                    </li>
                                                    <li class="navi-item">
                                                        <a href="#" class="navi-link" onclick="exportExcel()">
                                                            <span class="navi-icon">
                                                                <i class="la la-file-excel-o"></i>
                                                            </span>
                                                            <span class="navi-text">Excel</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                                <!--end::Navigation-->
                                            </div>
                                            <!--end::Dropdown Menu-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-9 col-xl-9 col-md-9 col-sm-9">
                                <div class="row align-items-center justify-content-end">
                                    <div class="col-lg-offset-3 col-md-offset-12 col-sm-offset-12 mr-3 my-1">
                                        <input type="text" class="form-control text-center" placeholder="Tên đối tác" id="search_partner_name" />
                                    </div>
                                    <div class="col-lg-offset-3 col-md-offset-12 col-sm-offset-12 mr-3 my-1">
                                        <input type="text" class="form-control text-center" placeholder="Tên người đại diện" id="search_contact_point_name" />
                                    </div>
                                    <div class="col-lg-offset-3 col-md-offset-12 col-sm-offset-12 mr-3 my-1">
                                        <input type="text" class="form-control text-center" placeholder="Số hiệu" id="search_mou_code" />
                                    </div>
                                    <div class="col-lg-offset-3 col-md-offset-12 col-sm-offset-12 my-1">
                                        <a href="#" onclick="searchMOU()" class="btn btn-light-primary px-6 font-weight-bold float-right">Tìm kiếm</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mt-3">
                                <div class="row align-items-center justify-content-end">
                                    <a href="/MOU/List_Deleted" class="px-7">MOU đã xóa</a>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-offset-12 col-md-offset-12 col-sm-offset-12" style="overflow-x: auto">
                                <table class="table table-bordered table-hover table-checkable mou_table" id="">
                                    <thead>
                                        <tr>
                                            <th rowspan="2" class="">S<br />T<br />T</th>
                                            <th rowspan="2" class="">Số hiệu</th>
                                            <th colspan="4" class="text-center header-modify">Đối tác</th>
                                            <th colspan="3" class="text-center header-modify">Người đại diện</th>
                                            <th nowrap="nowrap" rowspan="2" class="text-center">Bản mềm</th>
                                            <th nowrap="nowrap" rowspan="2" class="text-center">Ngày ký</th>
                                            <th nowrap="nowrap" rowspan="2" class="text-center">Ngày hết hạn</th>
                                            <th rowspan="2" class="text-center" nowrap="nowrap">Đơn vị - Cơ sở ký kết</th>
                                            <th rowspan="2" class="text-center" nowrap="nowrap">Phạm vi hợp tác</th>
                                            <th rowspan="2" nowrap="nowrap" class="text-center">Trạng thái</th>
                                            <th rowspan="2" nowrap="nowrap" class="text-center"></th>
                                        </tr>
                                        <tr>
                                            <th class="text-center">Tên</th>
                                            <th class="text-center">Quốc gia</th>
                                            <th class="text-center">Website</th>
                                            <th class="text-center">Lĩnh vực</th>
                                            <th class="text-center">Họ và tên</th>
                                            <th class="text-center">Email</th>
                                            <th class="text-center">Điện thoại</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    @*modal add_mou*@
    <div class="modal fade in" id="add_mou_modal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header justify-content-center">
                    <h3 class="modal-title font-weight-bolder" id="e">THÊM BIÊN BẢN GHI NHỚ</h3>
                </div>
                <div class="justify-content-center">
                    <div class="custom-container">
                        <ul class="progressbar">
                            <li class="active"></li>
                            <li></li>
                        </ul>
                    </div>
                </div>
                <div id='step-1' class="modal-body">
                    <div class="row justify-content-center">
                        <div class="col-xl-5 col-lg-5 col-md-5 col-sm-5">
                            <label class="font-weight-bolder">Số hiệu</label>
                            <label style="color:red"> *</label>
                            <label style="font-style: italic;">
                            </label>
                            <input class="form-control" type="text" placeholder="Số hiệu" autocomplete="off" required id="mou_code_add" value="@ViewBag.newMOUCode" />
                        </div>
                        <div class="col-xl-5 col-lg-5 col-md-5 col-sm-5">
                            <label class="font-weight-bolder">Đơn vị - Cơ sở kí kết</label>&nbsp;
                            <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                <select class="form-control select-search" id="search_coso" name="param" list="officeList" style="width:100% !important">
                                    @foreach (var item in ViewBag.listOffice)
                                    {
                                        <option value="@item.office_id">@item.office_abbreviation</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <div class="col-xl-5 col-lg-5 col-md-5 col-sm-5">
                            <label class="font-weight-bolder">Thời gian kí kết</label>&nbsp;
                            <label style="font-style: italic;">
                                (Cập nhật theo thời gian kí kết)
                            </label>
                            <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_sign_date" data-target-input="nearest">
                                <input disabled type="text" class="form-control datetimepicker-input" placeholder="Thời gian kí kết" id="sign_date_mou" data-target="#kt_datetimepicker_sign_date" />
                                <div class="input-group-append" data-target="#kt_datetimepicker_sign_date" data-toggle="datetimepicker">
                                    <span class="input-group-text">
                                        <i class="ki ki-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-5 col-lg-5 col-md-5 col-sm-5">
                            <label class="font-weight-bolder">Thời gian hết hạn</label>&nbsp;
                            <label style="font-style: italic;">
                            </label>
                            <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_end_date" data-target-input="nearest">
                                <input readonly type="text" class="form-control datetimepicker-input" placeholder="Thời gian hết hạn" id="end_date_mou" data-target="#kt_datetimepicker_end_date" />
                                <div class="input-group-append" data-target="#kt_datetimepicker_end_date" data-toggle="datetimepicker">
                                    <span class="input-group-text">
                                        <i class="ki ki-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <div class="col-xl-3 col-lg-3 col-md-4 col-sm-4">
                            <label class="font-weight-bolder">Trạng thái</label>&nbsp;
                            <select class="form-control" required id="status_mou">
                                <option value="2">Inactive</option>
                                <option value="1">Active</option>
                            </select>
                        </div>
                        <div class="col-xl-7 col-lg-7 col-md-8 col-sm-8">
                            <label class="font-weight-bolder">Ghi chú</label>&nbsp;
                            <input class="form-control" type="text" placeholder="Ghi chú" autocomplete="off" required id="note_mou" />
                        </div>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <div class="col-xl-10 col-lg-10 col-md-12 col-sm-12">
                            <label class="font-weight-bolder">Phạm vi hợp tác chính</label>&nbsp;
                            <label style="font-style: italic;">
                                (Cập nhật theo pham vi hợp tác của các đối tác kí kết)
                            </label>
                            <input disabled class="form-control" type="text" placeholder="Phạm vi hợp tác" autocomplete="off" required id="coop_scope_mou" />
                        </div>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <div class="col-xl-10 col-lg-10 col-md-12 col-sm-12">
                            <label class="font-weight-bolder">Bản mềm</label>&nbsp;
                            <label style="font-style: italic;">(Tối đa 1MB và 5 tệp tin)</label>
                            <div class="uppy row" id="mou_upload">
                                <div class="uppy-wrapper col-3"></div>
                                <div class="uppy-list col-7"></div>
                                <div class="uppy-status"></div>
                                <div class="uppy-informer uppy-informer-min"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <div class="col-xl-10 col-lg-1 col-md-12 col-sm-12">
                            <label class="font-weight-bolder">Lưu ý</label>&nbsp;
                            <textarea class="form-control " id="mou_area" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div id='step-2' class="modal-body" style="display:none">
                    <div class="col-lg-3 col-xl-3 col-md-3 col-sm-12 mb-3">
                        <div class="row align-items-center">
                            <a href="#add_partner_mou" data-toggle="modal" id="add_partner_mou_btn" class="btn btn-sm btn-light-primary px-6 font-weight-bold">Thêm</a>
                        </div>
                    </div>
                    <table class="table table-bordered table-hover table-checkable"
                           id="mou-partner-table">
                        <thead>
                            <tr>
                                <th class="text-center" rowspan="2">STT</th>
                                <th class="text-center" rowspan="2">Tên đối tác</th>
                                <th class="text-center" colspan="3">Người đại diện</th>
                                <th class="text-center" rowspan="2"></th>
                            </tr>
                            <tr>
                                <th class="text-center">Họ và tên</th>
                                <th class="text-center">Điện thoại</th>
                                <th class="text-center">Email</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button id="step-1-close-btn" type="button" class="btn btn-sm btn-secondary font-weight-bold px-6" data-dismiss="modal">Đóng</button>
                    <button id='step-1-button' type="button" class="btn btn-sm btn-light-primary font-weight-bold px-6" onclick="nextStep()">Tiếp</button>
                    <button id='step-2-backbutton' type="button" class="btn btn-sm btn-secondary font-weight-bold px-6" onclick="backToStep()" style="display:none">Quay về</button>
                    <button id='step-2-button' type="button" class="btn btn-sm btn-light-success font-weight-bold px-6" onclick="doneStep()" style="display:none">Hoàn thành</button>
                </div>
            </div>
        </div>
    </div>


    @*modal add_partner_mou*@
    <div class="modal fade in" id="add_partner_mou" aria-hidden="true" style="z-index: 8888">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header justify-content-center row">
                    <h4 class="modal-title font-weight-bolder" id="add_partner_mou_title">THÊM ĐỐI TÁC TRONG BIÊN BẢN GHI NHỚ</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label style="color:red">*</label>
                            <label class="font-weight-bolder">Tên đối tác</label>
                            <label style="color:blue" class="float-right"><a href="#" onclick="checkPartnerAdd()">Kiểm tra</a></label>
                            @*<div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                    <input hidden readonly type="text" class="form-control" id="partner_id_add" placeholder="" name="" value="" />
                                    <input type="text" class="form-control" id="partner_name_add" list="partnerList" onchange="preventAdd()" />
                                </div>*@
                            <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                <select class="form-control select-search" id="partner_name_add" name="param" list="officeList" style="width:100% !important">
                                    @foreach (var item in ViewBag.listPartners)
                                    {
                                        <option value="@item.partner_name">@item.partner_name</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Quốc gia</label>
                            <input class="form-control " type="text" placeholder="Quốc gia" autocomplete="off" id="nation_add" />
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label style="color:red">*</label>
                                <label class="font-weight-bolder">Tên đối tác</label>
                                <label style="color:blue" class="float-right"><a href="#top" onclick="checkPartnerAdd()">Kiểm tra</a></label>
                                @*<div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                        <input type="text" class="form-control" id="partner_name_add" list="partnerList" onchange="preventAdd()" />
                                    </div>*@
                                <input hidden readonly type="text" class="form-control" id="partner_id_add" placeholder="" name="" value="" />
                                <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                    <select class="form-control select-search" id="partner_name_add" name="param" list="officeList" style="width:100% !important">
                                        @foreach (var item in ViewBag.listPartners)
                                        {
                                            <option value="@item.partner_name">@item.partner_name</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Quốc gia</label>
                                <input class="form-control " type="text" placeholder="Quốc gia" autocomplete="off" id="nation_add" />
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Website</label>
                                <input class="form-control" type="text" placeholder="Website" autocomplete="off" id="website_add" />
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Địa chỉ đối tác</label>
                                <input class="form-control " type="text" placeholder="Địa chỉ đối tác" autocomplete="off" id="address_add" />
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Đại diện</label>
                                <input class="form-control " type="text" placeholder="Đại diện" autocomplete="off" id="represent_add" />
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Email</label>
                                <input class="form-control " type="text" placeholder="Email" autocomplete="off" id="email_add" />
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label class="font-weight-bolder">Số điện thoại</label>
                                <input class="form-control " type="text" placeholder="Số điện thoại" autocomplete="off" id="phone_add" />
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label style="color:red">*</label>
                                <label class="font-weight-bolder">Ngày ký kết</label>
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_sign_date_add" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" id="sign_date_mou_add" data-target="#kt_datetimepicker_sign_date_add" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_sign_date_add" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label style="color:red">*</label>
                                <label class="font-weight-bolder">Lĩnh vực</label>
                                <label style="color:blue" class="float-right"><a href="#">Quản lý</a></label>
                                <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                    <select class="form-control select2" id="specialization_add" name="param" multiple="multiple" style="width:100% !important">
                                        @foreach (var item in ViewBag.listSpe)
                                        {
                                            <option value="@item.specialization_id">@item.specialization_name</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                <label style="color:red">*</label>
                                <label class="font-weight-bolder">Phạm vi hợp tác</label>
                                <label style="color:blue" class="float-right"><a href="#">Quản lý</a></label>
                                <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                    <select class="form-control select2" id="coop_scope_add" name="param" multiple="multiple" style="width:100% !important">
                                        @foreach (var item in ViewBag.listScopes)
                                        {
                                            <option value="@item.scope_id">@item.scope_abbreviation</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Đóng</button>
                        <button id="add_mou_partner_button" type="button" class="btn btn-sm btn-light-primary" data-dismiss="modal" onclick="addToTemp()" disabled>Thêm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*modal edit_partner_mou*@
    <div class="modal fade in" id="edit_partner_mou" aria-hidden="true" style="z-index: 8888">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header justify-content-center row">
                    <h4 class="modal-title font-weight-bolder" id="add_partner_mou_title">SỬA ĐỐI TÁC TRONG BIÊN BẢN GHI NHỚ</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label style="color:red">*</label>
                            <label class="font-weight-bolder">Tên đối tác</label>
                            <label style="color:blue" class="float-right"><a href="#" onclick="checkPartnerEdit()">Kiểm tra</a></label>
                            <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                <input hidden readonly type="text" class="form-control" id="idx_edit" placeholder="" name="idx_edit" value="no" />
                                <input hidden readonly type="text" class="form-control" id="partner_id_edit" placeholder="" name="" value="" />
                                <input type="text" class="form-control" id="partner_name_edit" list="partnerList" onchange="preventEdit()" />
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Quốc gia</label>
                            <input class="form-control " type="text" placeholder="Quốc gia" autocomplete="off" id="nation_edit" />
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Website</label>
                            <input class="form-control" type="text" placeholder="Website" autocomplete="off" id="website_edit" />
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Địa chỉ đối tác</label>
                            <input class="form-control " type="text" placeholder="Địa chỉ đối tác" autocomplete="off" id="address_edit" />
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Đại diện</label>
                            <input class="form-control " type="text" placeholder="Đại diện" autocomplete="off" id="represent_edit" />
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Email</label>
                            <input class="form-control " type="text" placeholder="Email" autocomplete="off" id="email_edit" />
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label class="font-weight-bolder">Số điện thoại</label>
                            <input class="form-control " type="text" placeholder="Số điện thoại" autocomplete="off" id="phone_edit" />
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label style="color:red">*</label>
                            <label class="font-weight-bolder">Ngày ký kết</label>
                            <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_sign_date_edit" data-target-input="nearest">
                                <input type="text" class="form-control datetimepicker-input" id="sign_date_mou_edit" data-target="#kt_datetimepicker_sign_date_edit" />
                                <div class="input-group-append" data-target="#kt_datetimepicker_sign_date_edit" data-toggle="datetimepicker">
                                    <span class="input-group-text">
                                        <i class="ki ki-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label style="color:red">*</label>
                            <label class="font-weight-bolder">Lĩnh vực</label>
                            <label style="color:blue" class="float-right"><a href="#">Quản lý</a></label>
                            <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                <select class="form-control select2" id="specialization_edit" name="param" multiple="multiple" style="width:100% !important">
                                </select>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6">
                            <label style="color:red">*</label>
                            <label class="font-weight-bolder">Phạm vi hợp tác</label>
                            <div class="d-flex align-items-center col-xl-12 col-lg-12 px-0">
                                <select class="form-control select2" id="coop_scope_edit" name="param" multiple="multiple" style="width:100% !important">
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Đóng</button>
                    <button id="edit_mou_partner_button" onclick="editTemp()" data-dismiss="modal" type="button" class="btn btn-sm btn-light-primary">Sửa</button>
                </div>
            </div>
        </div>
    </div>

    @*<datalist id="partnerList">
            @foreach (var item in ViewBag.listPartners)
            {
                <option>@item.partner_name</option>
            }
        </datalist>*@


    @*toast alert*@
    <!--<div id="toast-container-custom" class="toast-bottom-left-custom">-->
    @*toastr notice 90 days left*@
    <!--<div class="toast toast-warning toast-90" aria-live="assertive" style="display:none">
        <button type="button" class="toast-close-button" role="button">×</button>
        <div class="toast-message">
            Hiện có biên bản 2020/01 sắp hết hạn cccccccccccccccccccccc
        </div>
    </div>-->
    @*toastr notice 30 days left*@
    <!--<div class="toast toast-warning toast-30" aria-live="assertive" style="background-color: #f64e60; display:none">
            <button type="button" class="toast-close-button" role="button">×</button>
            <div class="toast-message">
                Clear itself?
            </div>
        </div>
    </div>-->

    @section scripts{
        <link href="~/Content/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" />
        <script src="~/Content/assets/plugins/custom/datatables/datatables.bundle.js"></script>
        @*@model int*@


        @*toast*@
        <script>
    $('.toast-close-button').click(function () {
            $(this).parent().fadeOut('slow');
        })

        $(document).ready(function () {
            var duration = @Html.Raw(Json.Encode(Model));
            if (duration < 90) {
                $('.toast-90').fadeIn('slow');
                $('.toast-30').fadeIn('slow');
            }
            if (duration < 30) {
                $('.toast-30').fadeIn('slow');
            }


        });
        </script>

        @*date-picker*@
        <script>
            var KTBootstrapDatetimepicker = function () {
                var baseDemos = function () {
                    $('.kt_datetimepicker_3').datetimepicker({
                        format: 'DD/MM/yyyy'
                    });

                }
                return {
                    // Public functions
                    init: function () {
                        baseDemos();
                    }
                };
            }();

            jQuery(document).ready(function () {
                KTBootstrapDatetimepicker.init();
            });
        </script>

        <script>
            //overflow
            $(document).ready(function () {
                $('.header-modify').css('padding', '13px');

            });
        </script>

        @*custom_wizard*@
        <script>
            var list = document.getElementsByClassName("progressbar")[0];
            itemList = list.getElementsByTagName("li");

            var div_step1 = document.getElementById("step-1");
            var div_step2 = document.getElementById("step-2");
            var button_step1 = document.getElementById("step-1-button");
            var step1_close_btn = document.getElementById("step-1-close-btn");
            var button_step2 = document.getElementById("step-2-button");
            var backbutton_step2 = document.getElementById("step-2-backbutton");

            function toggleNextStep() {
                itemList[0].classList.remove("active");
                itemList[0].classList.add("done");
                itemList[1].classList.add("active");
                div_step1.style.display = "none";
                button_step1.style.display = "none";
                step1_close_btn.style.display = "none";
                div_step2.style.display = "block";
                button_step2.style.display = "block";
                backbutton_step2.style.display = "block";
            }

            function toggleBackStep() {
                itemList[0].classList.add("active");
                itemList[0].classList.remove("done");
                itemList[1].classList.remove("active");
                div_step1.style.display = "block";
                button_step1.style.display = "block";
                step1_close_btn.style.display = "block";
                div_step2.style.display = "none";
                button_step2.style.display = "none";
                backbutton_step2.style.display = "none";
            }
        </script>

        @*upload*@
        <script src="~/Content/assets/plugins/custom/uppy/uppy.bundle.js?v=7.0.6"></script>
        <script>
            "use strict";

            // Class definition
            var KTUppy = function () {
                const Tus = Uppy.Tus;
                const ProgressBar = Uppy.ProgressBar;
                const StatusBar = Uppy.StatusBar;
                const FileInput = Uppy.FileInput;
                const Informer = Uppy.Informer;

                // to get uppy companions working, please refer to the official documentation here: https://uppy.io/docs/companion/
                const Dashboard = Uppy.Dashboard;
                const Dropbox = Uppy.Dropbox;
                const GoogleDrive = Uppy.GoogleDrive;
                const Instagram = Uppy.Instagram;
                const Webcam = Uppy.Webcam;

                // Private functions

                var initUppy5 = function (id_input) {
                    // Uppy variables
                    // For more info refer: https://uppy.io/
                    var elemId = id_input;
                    var id = '#' + elemId;
                    var $statusBar = $(id + ' .uppy-status');
                    var $uploadedList = $(id + ' .uppy-list');
                    var timeout;

                    var uppyMin = Uppy.Core({
                        debug: true,
                        autoProceed: true,
                        showProgressDetails: true,
                        restrictions: {
                            maxFileSize: 1000000, // 1mb
                            maxNumberOfFiles: 5,
                            minNumberOfFiles: 1
                        }
                    });

                    uppyMin.use(FileInput, { target: id + ' .uppy-wrapper', pretty: false });
                    uppyMin.use(Informer, { target: id + ' .uppy-informer' });

                    // demo file upload server
                    uppyMin.use(Tus, { endpoint: 'https://master.tus.io/files/' });
                    uppyMin.use(StatusBar, {
                        target: id + ' .uppy-status',
                        hideUploadButton: true,
                        hideAfterFinish: false
                    });

                    $(id + ' .uppy-FileInput-input').addClass('uppy-input-control').attr('id', elemId + '_input_control');
                    $(id + ' .uppy-FileInput-container').append('<label class="uppy-input-label btn btn-light-primary btn-sm btn-bold" for="' + (elemId + '_input_control') + '">Attach files</label>');

                    var $fileLabel = $(id + ' .uppy-input-label');

                    uppyMin.on('upload', function (data) {
                        $fileLabel.text("Uploading...");
                        $statusBar.addClass('uppy-status-ongoing');
                        $statusBar.removeClass('uppy-status-hidden');
                        clearTimeout(timeout);
                    });

                    uppyMin.on('complete', function (file) {
                        $.each(file.successful, function (index, value) {
                            var sizeLabel = "bytes";
                            var filesize = value.size;
                            if (filesize > 1024) {
                                filesize = filesize / 1024;
                                sizeLabel = "kb";

                                if (filesize > 1024) {
                                    filesize = filesize / 1024;
                                    sizeLabel = "MB";
                                }
                            }
                            var uploadListHtml = '<div class="uppy-list-item" data-id="' + value.id + '"><div class="uppy-list-label">' + value.name + ' (' + Math.round(filesize, 2) + ' ' + sizeLabel + ')</div><span class="uppy-list-remove" data-id="' + value.id + '"><i class="flaticon2-cancel-music"></i></span></div>';
                            $uploadedList.append(uploadListHtml);
                        });

                        $fileLabel.text("Add more files");

                        $statusBar.addClass('uppy-status-hidden');
                        $statusBar.removeClass('uppy-status-ongoing');
                    });

                    $(document).on('click', id + ' .uppy-list .uppy-list-remove', function () {
                        var itemId = $(this).attr('data-id');
                        uppyMin.removeFile(itemId);
                        $(id + ' .uppy-list-item[data-id="' + itemId + '"').remove();
                    });
                }


                return {
                    // public functions
                    init: function (id_input) {
                        initUppy5(id_input);
                        setTimeout(function () {

                        }, 2000);
                    }
                };
            }();

            KTUtil.ready(function () {
                KTUppy.init('mou_upload');
            });

        </script>

        @*custom select*@
        <script>

            $('#search_coso').select2({
                placeholder: 'Chọn cơ sở',
                allowClear: true,
            });

            $('#partner_name_add').select2({
                placeholder: 'Tên đối tác',
                allowClear: true,
                tags: true,
            });

            $('#partner_name').select2({
                placeholder: 'Tên đối tác',
                allowClear: true,
            });

            $('#specialization').select2({
                placeholder: 'Lĩnh vực',
                allowClear: true,
            });

            $('#coop-scope').select2({
                placeholder: 'Phạm vi hợp tác',
                allowClear: true,
            });

        </script>

        @*delete alert*@
        <script>
         //funtion delete
       function confirm_delete(id) {
        //function confirm_delete(id, action, controller) {
            var link = '@Url.Action("action", "controller")'
            link = link.replace("action", "Delete_MOU");
            link = link.replace("controller", "MOU");
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, delete it!",
                cancelButtonText: "No, cancel!",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: link,
                        data: { mou_id : id },
                        success: function (data) {
                            if (data = "") {
                                Swal.fire("Good job!", "You clicked the button!", "error");
                            } else {
                                Swal.fire("Deleted!", "Your file has been deleted.", "success")
                            }
                        },
                        error: function (data) {
                            Swal.fire("Good job!", "You clicked the button!", "error");
                        },
                    })
                }
            })
        };

        </script>

        @*multi select*@
        <script>
            // Class definition
            var KTSelect2 = function () {
                // Private functions
                var demos = function () {
                    // basic

                    // multi select
                    $('#specialization_add').select2({
                        placeholder: 'Chọn lĩnh vực',
                    });
                    $('#coop_scope_add').select2({
                        placeholder: 'Chọn phạm vi',
                    });
                    $('#specialization_edit').select2({
                        placeholder: 'Chọn lĩnh vực',
                    });
                    $('#coop_scope_edit').select2({
                        placeholder: 'Chọn phạm vi',
                    });
                }
                // Public functions
                return {
                    init: function () {
                        demos();
                    }
                };
            }();

            // Initialization
            jQuery(document).ready(function () {
                KTSelect2.init();
            });
        </script>

        @*mou*@
        <script>
    var rowIdx = 1;
    var listTempPartnerMOUAdd = [];
    var listScopes = [];
    var listSpe = [];
    var listPartners = [];
    var mou_table = $(".mou_table").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "Đang hiển thị từ _START_ đến _END_ của _TOTAL_ bản ghi",
            },
            searching: false,
            lengthChange: false,
            ajax: {
                    url: "@Url.Action("ViewMOU", "MOU")",
                    type: "POST",
                    datatype: "json",
                    data: {
                        "partner_name": function () { return $('#search_partner_name').val() },
                        "contact_point_name": function () { return $('#search_contact_point_name').val() },
                        "mou_code": function () { return $('#search_mou_code').val() },
                    },
                    cache: "false"
                },
            columns: [
                {
                    render: function () {
                        return rowIdx++;
                    }
                },
                { data: "mou_code" },
                { data: "partner_name" },
                { data: "country_name" },
                {
                    data: "website",
                    render: function (data) {
                        if (data == null) {
                            return "";
                        } else {
                            return '<a target="blank" href="' + data + '"><span class="svg-icon svg-icon-dark svg-icon-md"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2021-02-01-052524/theme/html/demo1/dist/../src/media/svg/icons/Design/Edit.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none"><path d="M13.544 10.456a4.368 4.368 0 0 0-6.176 0l-3.089 3.088a4.367 4.367 0 1 0 6.177 6.177L12 18.177m-1.544-4.633a4.368 4.368 0 0 0 6.177 0l3.088-3.088a4.368 4.368 0 0 0-6.177-6.177L12 5.823" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g></svg><!--end::Svg Icon--></span></a>';
                        }
                    }
                },
                { data: "specialization_name" },
                { data: "contact_point_name" },
                { data: "contact_phone_email" },
                { data: "contact_point_phone" },
                {
                    data: "evidence",
                    render: function (data) {
                        if (data == null) {
                            return "";
                        } else {
                            return '<a target="blank" href="' + data + '" data-toggle="modal"><span class="svg-icon svg-icon-dark svg-icon-md"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2021-02-01-052524/theme/html/demo1/dist/../src/media/svg/icons/Design/Edit.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7.71 3.5L1.15 15l3.43 6l6.55-11.5M9.73 15L6.3 21h13.12l3.43-6m-.57-1L15.42 2H8.57l6.86 12h6.85z" fill="#626262"/></svg><!--end::Svg Icon--></span></a>';
                        }
                    }
                },
                { data: "mou_start_date_string" },
                { data: "mou_end_date_string" },
                { data: "office_abbreviation" },
                { data: "scope_abbreviation" },
                {
                    data: "mou_status_id",
                    width: '150px',
                    render: function (data) {
                        var status = {
                            1: {
                                'title': 'Hết hạn',
                                'class': 'label-light-danger'
                            },
                            2: {
                                'title': 'Còn hạn',
                                'class': 'label-light-success'
                            }
                        };
                        if (typeof status[data] === 'undefined') {
                            return data;
                        }
                        return '<span class="label label-lg font-weight-bold ' + status[data].class + ' label-inline">' + status[data].title + '</span> ';
                    }
                },
                {
                    title: 'Hành động',
                    data: "mou_id",
                    orderable: false,
                    width: '125px',
                    render: function (data, type, full, meta) {
                        return '<a onclick=goDetail('+data+') class="btn btn-sm btn-light-primary px-6 font-weight-bold" style="margin-right: 10px;">Sửa</a>' +
                            '<a onclick="confirm_delete(' + data + ')" class="btn btn-sm btn-light-danger px-6 font-weight-bold" data-toggle="modal">Xóa</a>'
                    }
                },
        ],
        columnDefs: [
            {
                className: "text-center",
                targets: [0,4,9,12,13],
            },
            {
                className: "text-nowrap",
                targets: [5,6,8, -1]
            },
        ]
    });

    $(document).ready(function () {
        $("#specialization_add option").each(function () {
            listSpe.push({
                spe_id: $(this).val(),
                spe_name: $(this).text()
            });
        });
        $("#coop_scope_add option").each(function () {
            listScopes.push({
                scope_id: $(this).val(),
                scope_name: $(this).text()
            });
        });
    });

    function searchMOU() {
        mou_table.ajax.reload();
    }

    function checkPartnerAdd() {
        var partner_name = document.getElementById("partner_name_add").value;
        var em = { partner_name: partner_name };
        $.ajax({
            url: "@Url.Action("CheckPartner", "MOU")",
            type: "POST",
            data: JSON.stringify(em),
            contentType: "application/json;charset=utf-8",
            datatype: "json",
            success: function (data) {
                if (data == "") {
                    document.getElementById('nation_add').removeAttribute('disabled');
                    document.getElementById('website_add').removeAttribute('disabled');
                    document.getElementById('address_add').removeAttribute('disabled');
                    document.getElementById("nation_add").value = "";
                    document.getElementById("website_add").value = "";
                    document.getElementById("address_add").value = "";
                    document.getElementById("partner_id_add").value = "";
                } else {
                    document.getElementById('nation_add').setAttribute('disabled', '');
                    document.getElementById('website_add').setAttribute('disabled', '');
                    document.getElementById('address_add').setAttribute('disabled', '');
                    document.getElementById("nation_add").value = data.country_name == null ? "" : data.country_name;
                    document.getElementById("website_add").value = data.website == null ? "" : data.website;
                    document.getElementById("address_add").value = data.address == null ? "" : data.address;
                    document.getElementById("partner_id_add").value = data.partner_id == null ? "" : data.partner_id;
                }
                document.getElementById("add_mou_partner_button").removeAttribute('disabled');
            },
            error: function () {
                //alert("fail");
            }
        });
    }

    function checkPartnerEdit() {
        var partner_name = document.getElementById("partner_name_edit").value;
        var em = { partner_name: partner_name };
        $.ajax({
            url: "@Url.Action("CheckPartner", "MOU")",
            type: "POST",
            data: JSON.stringify(em),
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data == "") {
                    document.getElementById('nation_edit').removeAttribute('disabled');
                    document.getElementById('website_edit').removeAttribute('disabled');
                    document.getElementById('address_edit').removeAttribute('disabled');
                    document.getElementById("nation_edit").value = "";
                    document.getElementById("website_edit").value = "";
                    document.getElementById("address_edit").value = "";
                    document.getElementById("partner_id_edit").value = "";
                } else {
                    document.getElementById('nation_edit').setAttribute('disabled', '');
                    document.getElementById('website_edit').setAttribute('disabled', '');
                    document.getElementById('address_edit').setAttribute('disabled', '');
                    document.getElementById("nation_edit").value = data.country_name == null ? "" : data.country_name;
                    document.getElementById("website_edit").value = data.website == null ? "" : data.website;
                    document.getElementById("address_edit").value = data.address == null ? "" : data.address;
                    document.getElementById("partner_id_edit").value = data.partner_id == null ? "" : data.partner_id;
                }
                document.getElementById("edit_mou_partner_button").removeAttribute('disabled');
            },
            error: function () {
                //alert("fail");
            }
        });
    }

    function preventEdit() {
        document.getElementById("edit_mou_partner_button").setAttribute('disabled', '');
    }

    function preventAdd() {
        document.getElementById("add_mou_partner_button").setAttribute('disabled', '');
    }

    function addToTemp() {
        var TempObj = {
            partnername_add: document.getElementById("partner_name_add").value,
            represent_add: document.getElementById("represent_add").value,
            specialization_add: $("#specialization_add").val(),
            nation_add: document.getElementById("nation_add").value,
            website_add: document.getElementById("website_add").value,
            address_add: document.getElementById("address_add").value,
            email_add: document.getElementById("email_add").value,
            sign_date_mou_add: document.getElementById("sign_date_mou_add").value,
            phone_add: document.getElementById("phone_add").value,
            coop_scope_add: $("#coop_scope_add").val(),
            partner_id: document.getElementById("partner_id_add").value,
        }

        listTempPartnerMOUAdd.push(TempObj);
        clearInputAdd();
        initAndRefreshTableMOUAdd();
    }

    function clearInputAdd() {
        document.getElementById("partner_name_add").value = "";
        document.getElementById("represent_add").value = "";
        document.getElementById("specialization_add").value = "";
        document.getElementById("nation_add").value = "";
        document.getElementById("website_add").value = "";
        document.getElementById("address_add").value = "";
        document.getElementById("email_add").value = "";
        document.getElementById("sign_date_mou_add").value = "";
        document.getElementById("phone_add").value = "";
        document.getElementById("coop_scope_add").value = "";
    }

    function initAndRefreshTableMOUAdd() {
        resetTable();
        initTable();
    }

    function initTable() {
        var HTMLdata = null;
        for (idx = 0; idx < listTempPartnerMOUAdd.length; idx++) {
            HTMLdata += '<tr id="temp' + idx + '" "class="MOUPartnerTempList">';
            HTMLdata += '<td class="text-center">' + (idx + 1) + '</td>';
            HTMLdata += '<td class="text-center">' + listTempPartnerMOUAdd[idx].partnername_add + '</td>';
            HTMLdata += '<td class="text-center">' + listTempPartnerMOUAdd[idx].represent_add + '</td>';
            HTMLdata += '<td class="text-center">' + listTempPartnerMOUAdd[idx].phone_add + '</td>';
            HTMLdata += '<td class="text-center">' + listTempPartnerMOUAdd[idx].email_add + '</td>';
            var buttonEdit = '<a onclick="loadEditTemp(' + idx + ')" href="#edit_partner_mou" data-toggle="modal" class="btn btn-sm btn-light-primary px-6 font-weight-bold" style="margin-right: 10px;">Sửa</a>';
            var buttonDel = '<a onclick="confirm_delete_temp(' + (idx) + ')" class="btn btn-sm btn-light-danger px-6 font-weight-bold" data-toggle="modal">Xóa</a>'
            HTMLdata += '<td class="text-center">' + buttonEdit + buttonDel +'</td>';
            HTMLdata += '</tr>';
        }
        $('#mou-partner-table').append(HTMLdata);
    }

    function resetTable() {
        for (idx = 0; idx < listTempPartnerMOUAdd.length; idx++) {
            $("#temp"+idx).remove();
        }
    }

    function confirm_delete_temp(index) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "No, cancel!",
            reverseButtons: true
        }).then(function (result) {
            if (result.isConfirmed) {
                resetTable();
                listTempPartnerMOUAdd.splice(index, 1);
                initTable();
            }
        })
    }

    function loadEditTemp(index) {
        $("#idx_edit").val(index);
        var HTMLSpedata = "";
        var HTMLScopedata = "";
        $('#specialization_edit').empty();
        $('#coop_scope_edit').empty();
        for (i = 0; i < listSpe.length; i++) {
            //alert('Test of ' + listTempPartnerMOUAdd[index].specialization_add + ' and ' + listSpe[i].spe_id);
            if (listTempPartnerMOUAdd[index].specialization_add.includes(listSpe[i].spe_id)) {
                HTMLSpedata += '<option value = "' + listSpe[i].spe_id + '" selected>' + listSpe[i].spe_name + '</option>'

            } else {
                HTMLSpedata += '<option value = "' + listSpe[i].spe_id + '" >' + listSpe[i].spe_name + '</option>'
            }
        }
        for (j = 0; j < listScopes.length; j++) {
            if (listTempPartnerMOUAdd[index].coop_scope_add.includes(listScopes[j].scope_id)) {
                HTMLScopedata += '<option value = "' + listScopes[j].scope_id + '" selected>' + listScopes[j].scope_name + '</option>'
            } else {
                HTMLScopedata += '<option value = "' + listScopes[j].scope_id + '">' + listScopes[j].scope_name + '</option>'
            }
        }
        $('#specialization_edit').append(HTMLSpedata);
        $('#coop_scope_edit').append(HTMLScopedata);

        $('#partner_name_edit').val(listTempPartnerMOUAdd[index].partnername_add);
        $('#represent_edit').val(listTempPartnerMOUAdd[index].represent_add);
        $('#nation_edit').val(listTempPartnerMOUAdd[index].nation_add);
        $('#website_edit').val(listTempPartnerMOUAdd[index].website_add);
        $('#address_edit').val(listTempPartnerMOUAdd[index].address_add);
        $('#email_edit').val(listTempPartnerMOUAdd[index].email_add);
        $('#sign_date_mou_edit').val(listTempPartnerMOUAdd[index].sign_date_mou_add);
        $('#phone_edit').val(listTempPartnerMOUAdd[index].phone_add);
        $('#partner_id_edit').val(listTempPartnerMOUAdd[index].partner_id);

        if (listTempPartnerMOUAdd[index].partner_id == "") {
            document.getElementById('nation_edit').removeAttribute('disabled');
            document.getElementById('website_edit').removeAttribute('disabled');
            document.getElementById('address_edit').removeAttribute('disabled');


        } else {
            document.getElementById('nation_edit').setAttribute('disabled', '');
            document.getElementById('website_edit').setAttribute('disabled', '');
            document.getElementById('address_edit').setAttribute('disabled', '');

        }
    }

    function editTemp() {
        var index = $("#idx_edit").val();
        listTempPartnerMOUAdd[index].partnername_add = document.getElementById("partner_name_edit").value;
        listTempPartnerMOUAdd[index].represent_add = document.getElementById("represent_edit").value;
        listTempPartnerMOUAdd[index].specialization_add = $("#specialization_edit").val();
        listTempPartnerMOUAdd[index].nation_add = document.getElementById("nation_edit").value;
        listTempPartnerMOUAdd[index].website_add = document.getElementById("website_edit").value;
        listTempPartnerMOUAdd[index].address_add = document.getElementById("address_edit").value;
        listTempPartnerMOUAdd[index].email_add = document.getElementById("email_edit").value;
        listTempPartnerMOUAdd[index].sign_date_mou_add = document.getElementById("sign_date_mou_edit").value;
        listTempPartnerMOUAdd[index].phone_add = document.getElementById("phone_edit").value;
        listTempPartnerMOUAdd[index].coop_scope_add = $("#coop_scope_edit").val();
        listTempPartnerMOUAdd[index].partner_id = document.getElementById("partner_id_edit").value;
        initAndRefreshTableMOUAdd();
    }

    function doneStep() {
        if (listTempPartnerMOUAdd.length == 0) {
            toastr.error('Chưa có đối tác nào được thêm');
        } else {
            $('#add_mou_modal').modal('hide');
            toastr.success('Thêm thành công');
            addMOU();
        }
    }

    function nextStep() {
        toggleNextStep();
    }

    function updateMOUStartDateAndMainScope() {
        var max_date = '01/01/0001';
        var main_scopes = '';
        var new_main_scopes = '';
        for (idx = 0; idx < listTempPartnerMOUAdd.length; idx++) {
            if (Date.parse(listTempPartnerMOUAdd[idx].sign_date_mou_add) > Date.parse(max_date)) {
                max_date = listTempPartnerMOUAdd[idx].sign_date_mou_add;
            }
            main_scopes += (listTempPartnerMOUAdd[idx].coop_scope_add + ",");
        }

        //remove last element.
        if (main_scopes.endsWith(",")) {
            main_scopes = main_scopes.slice(0, -1);
        }

        //alert(listTempPartnerMOUAdd[0].coop_scope_add);
        var token = main_scopes.split(",");
        token.sort();

        //add to new_main_scopes
        var prev = null;
        for (j = 0; j < token.length; j++) {
            if (token[j] != prev) {
                prev = token[j];
                var obj = listScopes.find(x => x.scope_id == prev);
                if (obj != null) {
                    new_main_scopes += (obj.scope_name + ",");
                }
            }
        }
        //remove last element of new list
        if (new_main_scopes.endsWith(",")) {
            new_main_scopes = new_main_scopes.slice(0, -1);
        }

        if (max_date == '01/01/0001') {
            max_date = '';
        }

        $("#sign_date_mou").val(max_date);
        $("#coop_scope_mou").val(new_main_scopes);
    }

    function backToStep() {
        updateMOUStartDateAndMainScope();
        toggleBackStep();
    }

    function addMOU() {
        //collect basicInfo data.
        var BasicInfo = {
            mou_code: $('#mou_code_add').val() ,
            mou_end_date: $('#end_date_mou').val(),
            office_id: $('#search_coso').val(),
            mou_status_id: $('#status_mou').val(),
            reason: $('#note_mou').val(),
            mou_note: $('#mou_area').val()
        };

        var MOUAdd = {
            BasicInfo: BasicInfo,
            PartnerInfo: listTempPartnerMOUAdd,
        };
        $.ajax({
            url: "@Url.Action("Add_Mou", "MOU")",
            type: "POST",
            data: JSON.stringify(MOUAdd),
            contentType: "application/json;charset=utf-8",
            datatype: "json",
            cache: false,
            success: function (data) {

            },
            error: function () {
                //alert("fail");
            }
        });

        //collect Partner data.
        //Send to controller.
    }

    function exportExcel() {
        //alert('haha');
        $.ajax({
            url: "@Url.Action("ExportMOUExcel", "MOU")",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            datatype: "json",
            cache: false,
            success: function (data) {

            },
            error: function () {
                //alert("fail");
            }
        });
    }

    function goDetail(mou_id) {
        var id = { id: mou_id };
        $.ajax({
            url: "@Url.Action("PassDataToMOUDetail", "BasicInfoMOU")",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(id),
            datatype: "json",
            cache: false,
            success: function (data) {
                window.location.href = './MOU/Detail';
            },
            error: function () {

            }
        });
    }
        </script>
    }

