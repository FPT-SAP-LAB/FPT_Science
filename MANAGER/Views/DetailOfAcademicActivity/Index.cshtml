
@{
    ViewBag.Title = "Thông tin hoạt động học thuật";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .customrow {
        margin-bottom: 10px;
    }

    .customabtn2 {
        border: 1px solid #16854d;
        padding: 5px 16px;
        text-decoration: none;
        cursor: pointer;
        color: #ffffff !important;
        border-radius: 5px;
        background-color: #16854d;
        text-align: center;
        position: absolute;
    }

    .modal {
        overflow-y: auto;
    }

    .ck-content {
        min-height: 60px !important;
    }
</style>
<div class="card card-custom">
    <div class="card-body custom-card pt-3">
        <div class="row">
            <div class="col-sm-8 col-md-8 col-xl-8 pl-0 ml-0">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#kt_tab_pane_1">
                            <span class="nav-text">Nội dung</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_2">
                            <span class="nav-text">Đăng kí tham dự</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_3">
                            <span class="nav-text">Kinh phí</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_4">
                            <span class="nav-text">Đơn vị đồng tổ chức</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-sm-4 col-md-4 col-xl-4 col-lg-4">
                <a href="javascript:;" id="remove_activity" class="btn btn-light-danger font-weight-bold float-right" hidden onclick="changeStatusActivity(1)">Thu hồi</a>
                <a href="javascript:;" id="post_activity" class="btn btn-light-primary font-weight-bold float-right" hidden onclick="changeStatusActivity(2)">Đăng bài</a>
            </div>
        </div>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="kt_tab_pane_1" role="tabpanel" aria-labelledby="kt_tab_pane_1">
                <div class="form-group row">
                    <div class="col-md-8 col-xl-8 col-lg-8">
                        <label class="font-weight-bolder">Tiêu đề</label>
                        <input type="text" class="form-control" placeholder="Tiêu đề" required autocomplete="off" id="detail_name" />
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <label class="font-weight-bolder">Loại</label>
                        <select class="form-control" id="detail_category">
                            @{
                                foreach (var i in ViewBag.types)
                                {
                                    <option value="@i.activity_type_id">@i.activity_type_name</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Thời hạn từ</label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_detail_from" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="Thời hạn từ" data-target="#kt_datetimepicker_detail_from" autocomplete="off" id="detail_from" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_detail_from" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">đến</label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_detail_to" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="đến từ" data-target="#kt_datetimepicker_detail_to" autocomplete="off" id="detail_to" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_detail_to" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 col-xl-2 col-lg-2">
                    </div>
                    <div class="col-md-8 col-xl-8 col-lg-8">
                        <label class="col-form-label font-weight-bolder">Địa điểm</label>
                        <input class="form-control" type="text" required autocomplete="off" placeholder="Địa điểm" id="detail_location" />
                    </div>
                    <div class="col-md-2 col-xl-2 col-lg-2">
                    </div>
                    <div class="col-md-2 col-xl-2 col-lg-2">
                        <label class="col-form-label font-weight-bolder">Ngôn ngữ</label>
                        <select class="form-control" id="detail_language_content" onchange="reInit()">
                            <option selected value="1">Tiếng Việt</option>
                            <option value="2">Tiếng Anh</option>
                        </select>
                    </div>
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12 mt-5">
                        <div id="editor-main-content" class="summernote"></div>
                    </div>
                    <div id="subcontent-control" class="col-md-12 col-lg-12 col-xl-12 col-sm-12 mt-5">
                    </div>
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12 mt-5">
                        <button type="button" class="btn btn-light-primary btn-sm px-6" onclick="bonusRowContent(0)">Thêm</button>
                    </div>
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12 mt-5">
                        <button type="button" class="btn btn-primary btn-sm px-6 float-right" id="btn_detail">Lưu</button>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="kt_tab_pane_2" role="tabpanel" aria-labelledby="kt_tab_pane_2">
                <div class="row mb-3">
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12">
                        <a href="javascripts:;" class="btn btn-light-primary btn-sm px-6 font-weight-bold" data-toggle="modal" data-target="#addModal_Giaidoan">Thêm giai đoạn</a>
                    </div>
                </div>
                <table id="GiaiDoanDatatable" class="table table-bordered table-checkable">
                    <thead>
                        <tr>
                            <th class="text-center">STT</th>
                            <th class="text-center">Giai đoạn</th>
                            <th class="text-center">Thời gian bắt đầu</th>
                            <th class="text-center">Thời gian kết thúc</th>
                            <th class="text-center">Người đăng</th>
                            <th class="text-center"></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="row">
                        <a href="javascript:;" class="btn btn-light-primary btn-sm font-weight-bold" onclick="viewThongKeDKTD()" style="min-width:max-content !important">Thống kê đăng kí tham dự</a>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="kt_tab_pane_3" role="tabpanel" aria-labelledby="kt_tab_pane_3">
                <div class="row mb-3">
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12">
                        <a href="#" class="btn btn-light-primary btn-sm px-6 font-weight-bold" data-toggle="modal" data-target="#addModal_KinhPhi">Thêm đơn vị</a>
                    </div>
                </div>
                <table id="KinhPhiDatatable" class="table table-bordered table-checkable">
                    <thead>
                        <tr class="text-center">
                            <th rowspan="2">STT</th>
                            <th rowspan="2">Đơn vị</th>
                            <th colspan="2">Kinh phí dự trù (VNĐ)</th>
                            <th rowspan="2">Kinh phí thực tế (VNĐ)</th>
                            <th rowspan="2">Chênh lệch (VNĐ)</th>
                            <th rowspan="2"></th>
                        </tr>
                        <tr>
                            <th class="text-center">Ban đầu</th>
                            <th class="text-center">Điều chỉnh</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="row">
                        <div class="dropdown">
                            <button class="btn btn-light-primary btn-sm dropdown-toggle" type="button" id="dropdown-excel" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Xuất kinh phí</button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a href="javascript:;" class="dropdown-item" onclick="excelDuTru()">Dự trù ban đầu</a>
                                <a href="javascript:;" class="dropdown-item" onclick="excelDieuChinh()">Dự trù điều chỉnh</a>
                                <a href="javascript:;" class="dropdown-item" onclick="excelThucTe()">Thực tế</a>
                                <a href="javascript:;" class="dropdown-item" onclick="excelTonghop()">Tổng hợp</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="kt_tab_pane_4" role="tabpanel" aria-labelledby="kt_tab_pane_4">
                <div class="row mb-3">
                    <div class="col-md-12 col-lg-12 col-xl-12 col-sm-12">
                        <a href="#" class="btn btn-light-primary btn-sm px-6 font-weight-bold" data-toggle="modal" data-target="#addModal_DongToChuc">Bổ sung đơn vị</a>
                    </div>
                </div>
                <table id="DongTochucDatatable" class="table table-bordered table-checkable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Tên đơn vị</th>
                            <th>Thời gian bắt đầu</th>
                            <th>Thời gian kết thúc</th>
                            <th>Đầu mối liên hệ</th>
                            <th>Nguồn tài trợ (VNĐ)</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ThongKeDKTD" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Thống kê số lượng đăng kí tham dự</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-md-6 col-xl-6 col-lg-6 col-xl-6">
                        @*<a href="javascript:;" class="btn btn-light-primary px-6 font-weight-bold" onclick="excelSL()">Xuất excel</a>*@
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3 col-xl-3 justify-content-end pt-3 pr-0 text-right">
                        Thống kê theo:
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3 col-xl-3 justify-content-end">
                        <select class="form-control" onchange="filterSLby()" id="filterSL">
                            <option selected value="DF">Tổng số</option>
                            <option value="CS">Cơ sở</option>
                            <option value="DV">Đơn vị</option>
                        </select>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <table id="ThongKeSLDatatable" class="table table-bordered table-checkable">
                            <thead>
                                <tr class="text-center">
                                    <th></th>
                                    <th>Người đăng kí</th>
                                    <th>Người tham dự</th>
                                </tr>
                            </thead>
                            <tbody>
  
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal_DongToChuc" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Bổ sung đơn vị đồng tổ chức</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Đơn vị đối tác</label>
                        <label style="color:red">*</label>
                        <div class="d-flex align-items-center">
                            <select class="form-control" id="add_donvi_DongToChuc" style="width: 100% !important">
                                <option selected></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Nguồn tài trợ (VNĐ)</label>
                        <input class="form-control" type="number" placeholder="Nguồn tài trợ" autocomplete="off" required id="add_taitro_DongToChuc" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Phạm vi hợp tác</label>
                        <label style="color:red">*</label>
                        <div class="d-flex align-items-center">
                            <select class="form-control" id="add_phamvihoptac_DongToChuc" style="width: 100% !important">
                                <option selected></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Thời hạn từ </label>
                        <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_add_from_DongToChuc" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" placeholder="Thời hạn từ" data-target="#kt_datetimepicker_add_from_DongToChuc" autocomplete="off" id="add_from_DongToChuc" />
                            <div class="input-group-append" data-target="#kt_datetimepicker_add_from_DongToChuc" data-toggle="datetimepicker">
                                <span class="input-group-text">
                                    <i class="ki ki-calendar"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">đến</label>
                        <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_add_to_DongToChuc" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" placeholder="đến từ" data-target="#kt_datetimepicker_add_to_DongToChuc" autocomplete="off" id="add_to_DongToChuc" />
                            <div class="input-group-append" data-target="#kt_datetimepicker_add_to_DongToChuc" data-toggle="datetimepicker">
                                <span class="input-group-text">
                                    <i class="ki ki-calendar"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <label style="font-style: italic;">(Tối đa 5MB và 1 tệp tin)</label>
                        <div class="uppy" id="add_banmem_DongToChuc">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                        </div>
                    </div>

                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="font-weight-bolder">Đầu mối liên hệ</label>
                        <div class="form-group row">
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Họ và tên" autocomplete="off" id="add_name_DongToChuc" />
                            </div>
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Email" autocomplete="off" id="add_email_DongToChuc" />
                            </div>
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Số điện thoại" autocomplete="off" id="add_phone_DongToChuc" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal" id="btn_add_close_DongToChuc">Đóng</button>
                <button type="button" class="btn btn-light-success font-weight-bold" id="btn_add_save_DongToChuc">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal_DongToChuc" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Bổ sung đơn vị đồng tổ chức</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Tên đơn vị</label>
                        <div class="d-flex align-items-center">
                            <select class="form-control" id="edit_donvi_DongToChuc" style="width: 100% !important">
                                <option selected></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Nguồn tài trợ (VNĐ)</label>
                        <input class="form-control" type="number" placeholder="Nguồn tài trợ" autocomplete="off" id="edit_taitro_DongToChuc" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Phạm vi hợp tác</label>
                        <div class="d-flex align-items-center">
                            <select class="form-control" id="edit_phamvihoptac_DongToChuc" style="width: 100% !important">
                                <option selected></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Thời hạn từ </label>
                        <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_edit_from_DongToChuc" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" placeholder="Thời hạn từ" data-target="#kt_datetimepicker_edit_from_DongToChuc" autocomplete="off" id="edit_from_DongToChuc" />
                            <div class="input-group-append" data-target="#kt_datetimepicker_edit_from_DongToChuc" data-toggle="datetimepicker">
                                <span class="input-group-text">
                                    <i class="ki ki-calendar"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">đến</label>
                        <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_edit_to_DongToChuc" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" placeholder="đến từ" data-target="#kt_datetimepicker_edit_to_DongToChuc" autocomplete="off" id="edit_to_DongToChuc" />
                            <div class="input-group-append" data-target="#kt_datetimepicker_edit_to_DongToChuc" data-toggle="datetimepicker">
                                <span class="input-group-text">
                                    <i class="ki ki-calendar"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <label style="font-style: italic;">(Tối đa 5MB và 1 tệp tin)</label>
                        <div class="uppy" id="edit_banmem_DongToChuc">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                            <div id="edit_DongToChuc_file_content_upload"></div>
                        </div>
                    </div>

                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="font-weight-bolder">Đầu mối liên hệ</label>
                        <div class="form-group row">
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Họ và tên" autocomplete="off" id="edit_name_DongToChuc" />
                            </div>
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Email" autocomplete="off" id="edit_email_DongToChuc" />
                            </div>
                            <div class="col-4">
                                <input class="form-control" type="text" placeholder="Số điện thoại" autocomplete="off" id="edit_phone_DongToChuc" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success font-weight-bold" data-dismiss="modal" id="btn_edit_save_DongToChuc">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal_Giaidoan" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Thêm giai đoạn</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Giai đoạn</label>
                        <input class="form-control" type="text" placeholder="Giai đoạn" autocomplete="off" required id="add_name_giaidoan" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Thời hạn từ </label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_add_from_giaidoan" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="Thời hạn từ" data-target="#kt_datetimepicker_add_from_giaidoan" autocomplete="off" id="add_from_giaidoan" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_add_from_giaidoan" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">đến</label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_add_to_giaidoan" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="đến từ" data-target="#kt_datetimepicker_add_to_giaidoan" autocomplete="off" id="add_to_giaidoan" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_add_to_giaidoan" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success px-6 font-weight-bold" id="btn_add_giaidoan">Xác nhận</button>
            </div>
        </div>
    </div>
</div>
@*ádsa*@
<div class="modal fade" id="addModal_Tucach" tabindex="-1" role="dialog" aria-hidden="true" style="z-index:9999">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Thêm tư cách tham gia</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Tư cách tham gia</label>
                        <input class="form-control" type="text" placeholder="Tư cách tham gia" autocomplete="off" id="add_name_tucach" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" id="add_quantity_tucach" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="checkbox pt-15 ">
                            <input type="checkbox" id="add_donvi_tucach" onchange="clickDonviTucachAdd()" />
                            <span class="mr-3"></span>
                            Đơn vị cơ sở
                        </label>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <div id="add_control_title">
                            <div class="row">
                                <div class="col-md-6 col-xl-6 col-lg-6">
                                    <label class="col-form-label font-weight-bolder">Đơn vị cơ sở</label>
                                </div>
                                <div class="col-md-5 col-xl-5 col-lg-5">
                                    <label class="col-form-label font-weight-bolder">Số lượng</label>
                                </div>
                                <div class="col-md-1 col-xl-1 col-lg-1">
                                    <label class="col-form-label font-weight-bolder"></label>
                                </div>
                            </div>
                        </div>
                        <div id="add_control">

                        </div>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12 pb-3">
                        <div id="add_control_btn">
                            <a href="#" class="btn-sm btn btn-primary" onclick="bonusRow(0)">
                                <i class="fas fa-plus" style="color: #ffffff;padding:0px !important"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Chi phí</label>
                        <select class="form-control" id="add_price_tucach" onchange="clickAddPriceTuCach()">
                            <option value="MP">Miễn phí</option>
                            <option value="CP">Có phí</option>
                        </select>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <div id="add_control_price">
                            <label class="col-form-label font-weight-bolder">Mức giá</label>
                            <input type="number" class="form-control" placeholder="Mức giá" autocomplete="off" id="add_cost_tucach" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success px-6 font-weight-bold" data-dismiss="modal" id="btn_add_tucach">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

@*asdasđasad*@
@*ádasd*@
<div class="modal fade" id="editModal_Tucach" tabindex="-1" role="dialog" aria-hidden="true" style="z-index:9999">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa tư cách tham gia</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Tư cách tham gia</label>
                        <input class="form-control" type="text" placeholder="Tư cách tham gia" autocomplete="off" id="edit_name_tucach" value="Người tham dự" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" id="edit_quantity_tucach" value="30" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="checkbox pt-15 ">
                            <input type="checkbox" id="edit_donvi_tucach" onchange="clickDonviTucachEdit()" />
                            <span class="mr-3"></span>
                            Đơn vị cơ sở
                        </label>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <div id="edit_control_title">
                            <div class="row">
                                <div class="col-md-6 col-xl-6 col-lg-6">
                                    <label class="col-form-label font-weight-bolder">Đơn vị cơ sở</label>
                                </div>
                                <div class="col-md-5 col-xl-5 col-lg-5">
                                    <label class="col-form-label font-weight-bolder">Số lượng</label>
                                </div>
                                <div class="col-md-1 col-xl-1 col-lg-1">
                                    <label class="col-form-label font-weight-bolder"></label>
                                </div>
                            </div>
                        </div>
                        <div id="edit_control">

                        </div>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12 pb-3">
                        <div id="edit_control_btn">
                            <a href="#" class="btn-sm btn btn-primary" onclick="bonusRowEdit(0)">
                                <i class="fas fa-plus" style="color: #ffffff;padding:0px !important"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Chi phí</label>
                        <select class="form-control" id="edit_price_tucach" onchange="clickEditPriceTuCach()">
                            <option selected value="MP">Miễn phí</option>
                            <option value="CP">Có phí</option>
                        </select>
                    </div>
                    <div class="col-md-4 col-xl-4 col-lg-4">
                        <div id="edit_control_price">
                            <label class="col-form-label font-weight-bolder">Mức giá</label>
                            <input type="number" class="form-control" placeholder="Mức giá" autocomplete="off" id="edit_cost_tucach" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success px-6 font-weight-bold" data-dismiss="modal" id="btn_edit_tucach">Xác nhận</button>
            </div>
        </div>
    </div>
</div>
@*cc*@
<div class="modal fade" id="editModal_Giaidoan" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa giai đoạn học thuật</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="form-group row pb-0 mb-0">
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Giai đoạn</label>
                        <input class="form-control" type="text" placeholder="Giai đoạn" autocomplete="off" required id="edit_name_giaidoan" />
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">Thời hạn từ </label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_edit_from_giaidoan" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="Thời hạn từ" data-target="#kt_datetimepicker_edit_from_giaidoan" autocomplete="off" id="edit_from_giaidoan" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_edit_from_giaidoan" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6">
                        <label class="col-form-label font-weight-bolder">đến</label>
                        <div class="form-group row">
                            <div class="col-lg-12 col-md-9 col-sm-12">
                                <div class="input-group date kt_datetimepicker_3" id="kt_datetimepicker_edit_to_giaidoan" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" placeholder="đến từ" data-target="#kt_datetimepicker_edit_to_giaidoan" autocomplete="off" id="edit_to_giaidoan" />
                                    <div class="input-group-append" data-target="#kt_datetimepicker_edit_to_giaidoan" data-toggle="datetimepicker">
                                        <span class="input-group-text">
                                            <i class="ki ki-calendar"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-header pb-3">
                <h3 class="modal-title font-weight-bolder">Danh sách tư cách tham gia</h3>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-md-6 col-xl-6 col-lg-6 my-3">
                        <a href="javascript:;" class="btn btn-light-primary btn-sm font-weight-bold" data-toggle="modal" data-target="#addModal_Tucach">Thêm tư cách</a>
                    </div>
                    <div class="col-md-6 col-xl-6 col-lg-6 my-3">
                        <a href="javascript:;" class="btn btn-light-primary btn-sm font-weight-bold float-right" onclick="setUpForm()">Đơn đăng kí</a>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12">
                        <table id="TuCachDatatable" class="table table-bordered table-checkable">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Tư cách tham gia</th>
                                    <th>Mức phí (VNĐ)</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Người tham dự</td>
                                    <td>Miễn phí</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Người thuyết trình</td>
                                    <td>Miễn phí</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success px-6 font-weight-bold" data-dismiss="modal" id="btn_edit_giaidoan">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="KPDuTruModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Giải trình kinh phí dự trù ban đầu</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-md-6 col-xl-6 col-lg-6 my-3">
                        <a href="#" class="btn btn-light-primary btn-sm font-weight-bold" data-toggle="modal" data-target="#addModal_KPDuTru">Thêm nội dung</a>
                    </div>
                    <div class="col-md-12 col-xl-12 col-lg-12" style="zoom:90%">
                        <table id="KPDuTruDatatable" class="table table-bordered table-checkable">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Nội dung</th>
                                    <th>Đơn giá (VNĐ)</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền (VNĐ)</th>
                                    <th>Ghi chú</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal_KinhPhi" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Thêm đơn vị</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Đơn vị</label>
                        <select class="form-control" id="add_donvi_kinhphi">
                            @{
                                foreach (var item in ViewBag.office)
                                {
                                    <option value="@item.office_id">@item.office_name</option>
                                }
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-light-success px-6 font-weight-bold" data-dismiss="modal" id="btn_add_kinhphi">Xác nhận</button>
            </div>
        </div>
    </div>
</div>
@*aaa*@
<div class="modal fade" id="addModal_KPDuTru" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Thêm kinh phí dự trù ban đầu</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Nội dung</label>
                        <input type="text" class="form-control" placeholder="Nội dung" spellcheck="false" autocomplete="off" id="add_noidung_kpDuTru" />
                    </div>
                    <div class="col-sm-4 col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Đơn giá (VNĐ)</label>
                        <input type="number" class="form-control" placeholder="Đơn giá" autocomplete="off" onmousewheel="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" onclick="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" onkeyup="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" id="add_dongia_kpDuTru" />
                    </div>
                    <div class="col-sm-3 col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" onmousewheel="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" onclick="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" onkeyup="calcuaTotal('#add_dongia_kpDuTru','#add_soluong_kpDuTru','#add_thanhtien_kpDuTru')" id="add_soluong_kpDuTru" />
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Thành tiền (VNĐ)</label>
                        <input type="text" class="form-control" placeholder="Thành tiền" autocomplete="off" id="add_thanhtien_kpDuTru" readonly />
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">Ghi chú</label>
                        <textarea id="add_ghichu_kpDuTru" class="form-control" spellcheck="false"></textarea>
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <div class="uppy" id="kt_uppy_addKPDuTru">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                        </div>
                        <span class="form-text text-muted">Dung lượng tối đa là 3MB và tối đa 1 tập tin</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn load-btn btn-light-success font-weight-bold" id="btn_add_kpDuTru">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal_KPDuTru" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa kinh phí dự trù ban đầu</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Nội dung</label>
                        <input type="text" class="form-control" placeholder="Nội dung" spellcheck="false" autocomplete="off" id="edit_noidung_kpDuTru" />
                    </div>
                    <div class="col-sm-4 col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Đơn giá (VNĐ)</label>
                        <input type="number" class="form-control" placeholder="Đơn giá" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" onclick="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" onkeyup="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" id="edit_dongia_kpDuTru" />
                    </div>
                    <div class="col-sm-3 col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" onclick="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" onkeyup="calcuaTotal('#edit_dongia_kpDuTru','#edit_soluong_kpDuTru','#edit_thanhtien_kpDuTru')" id="edit_soluong_kpDuTru" />
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Thành tiền (VNĐ)</label>
                        <input type="text" class="form-control" placeholder="Thành tiền" autocomplete="off" id="edit_thanhtien_kpDuTru" />
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">Ghi chú</label>
                        <textarea id="edit_ghichu_kpDuTru" class="form-control" spellcheck="false"></textarea>
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <div class="uppy" id="kt_uppy_editKPDuTru">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                        </div>
                        <span class="form-text text-muted">Dung lượng tối đa là 3MB và tối đa 1 tập tin</span>
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">   
                        <label class="col-form-label font-weight-bolder">File đính kèm</label>
                        <a href="javascript:;" class="form-control" id="edit_dinhkem_kpDuTru"></a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn load-btn btn-light-success font-weight-bold" id="btn_edit_kpDuTru">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="KPDieuChinhModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Giải trình kinh phí điều chỉnh</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-md-12 col-xl-12 col-lg-12" style="zoom:90%">
                        <table id="KPDieuChinhDatatable" class="table table-bordered table-checkable">
                            <thead>
                                <tr class="text-center">
                                    <th rowspan="2">STT</th>
                                    <th rowspan="2">Nội dung</th>
                                    <th colspan="3">Kinh phí dự trù ban đầu  (VNĐ)</th>
                                    <th colspan="3">Kinh phí dự trù điều chỉnh (VNĐ)</th>
                                    <th rowspan="2">Ghi chú</th>
                                    <th rowspan="2"></th>
                                </tr>
                                <tr>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal_KPDieuChinh" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa kinh phí điều chỉnh</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Nội dung</label>
                        <input type="text" class="form-control" placeholder="Nội dung" spellcheck="false" autocomplete="off" id="edit_noidung_kpDieuChinh" />
                    </div>
                    <div class="col-sm-4 col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Đơn giá</label>
                        <input type="number" class="form-control" placeholder="Đơn giá" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" onclick="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" onkeyup="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" id="edit_dongia_kpDieuChinh" />
                    </div>
                    <div class="col-sm-3 col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" onclick="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" onkeyup="calcuaTotal('#edit_dongia_kpDieuChinh','#edit_soluong_kpDieuChinh','#edit_thanhtien_kpDieuChinh')" id="edit_soluong_kpDieuChinh" />
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Thành tiền</label>
                        <input type="text" class="form-control" placeholder="Thành tiền" autocomplete="off" id="edit_thanhtien_kpDieuChinh" />
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">Ghi chú</label>
                        <textarea id="edit_ghichu_kpDieuChinh" class="form-control" spellcheck="false">Thêm đội từ phía sinh viên</textarea>
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <div class="uppy" id="kt_uppy_editKPDieuChinh">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                        </div>
                        <span class="form-text text-muted">Dung lượng tối đa là 3MB và tối đa 1 tập tin</span>
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">File đính kèm</label>
                        <a href="javascript:;" class="form-control" id="edit_dinhkem_kpDieuChinh"></a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn load-btn btn-light-success font-weight-bold" id="btn_edit_kpDieuChinh">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="KPThucTeModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Giải trình kinh phí thực tế</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-md-12 col-xl-12 col-lg-12" style="zoom:90%">
                        <table id="KPThucTeDatatable" class="table table-bordered table-checkable">
                            <thead>
                                <tr class="text-center">
                                    <th rowspan="2">STT</th>
                                    <th rowspan="2">Nội dung</th>
                                    <th colspan="3">Kinh phí dự trù lần cuối (VNĐ)</th>
                                    <th colspan="3">Kinh phí thực tế (VNĐ)</th>
                                    <th rowspan="2">Ghi chú</th>
                                    <th rowspan="2"></th>
                                </tr>
                                <tr>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal_KPThucTe" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Chỉnh sửa kinh phí thực tế</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Nội dung</label>
                        <input type="text" class="form-control" placeholder="Nội dung" spellcheck="false" autocomplete="off" id="edit_noidung_kpThucTe" />
                    </div>
                    <div class="col-sm-4 col-md-4 col-xl-4 col-lg-4">
                        <label class="col-form-label font-weight-bolder">Đơn giá</label>
                        <input type="number" class="form-control" placeholder="Đơn giá" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" onclick="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" onkeyup="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" id="edit_dongia_kpThucTe" />
                    </div>
                    <div class="col-sm-3 col-md-3 col-xl-3 col-lg-3">
                        <label class="col-form-label font-weight-bolder">Số lượng</label>
                        <input type="number" class="form-control" placeholder="Số lượng" autocomplete="off" onmousewheel="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" onclick="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" onkeyup="calcuaTotal('#edit_dongia_kpThucTe','#edit_soluong_kpThucTe','#edit_thanhtien_kpThucTe')" id="edit_soluong_kpThucTe" />
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Thành tiền</label>
                        <input type="text" class="form-control" placeholder="Thành tiền" autocomplete="off" id="edit_thanhtien_kpThucTe" />
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">Ghi chú</label>
                        <textarea id="edit_ghichu_kpThucTe" class="form-control"></textarea>
                    </div>
                    <div class="col-sm-5 col-md-5 col-xl-5 col-lg-5">
                        <label class="col-form-label font-weight-bolder">Bản mềm</label>
                        <div class="uppy" id="kt_uppy_editKPThucTe">
                            <div class="uppy-wrapper"></div>
                            <div class="uppy-list"></div>
                            <div class="uppy-status"></div>
                            <div class="uppy-informer uppy-informer-min"></div>
                        </div>
                        <span class="form-text text-muted">Dung lượng tối đa là 3MB và tối đa 1 tập tin</span>
                    </div>
                    <div class="col-sm-7 col-md-7 col-xl-7 col-lg-7">
                        <label class="col-form-label font-weight-bolder">File đính kèm</label>
                        <a href="javascript:;" class="form-control" id="edit_dinhkem_kpThucTe"></a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary px-6 font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn load-btn btn-light-success font-weight-bold" id="btn_edit_kpThucTe">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewContactModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title font-weight-bolder">Đầu mối liên hệ</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body pt-3 pb-0">
                <div class="row form-group">
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Họ và tên</label>
                        <input class="form-control" type="text" readonly id="contact_name" />

                    </div>
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Email</label>
                        <input class="form-control" type="text" readonly id="contact_email" />
                    </div>
                    <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12">
                        <label class="col-form-label font-weight-bolder">Số điện thoại</label>
                        <input class="form-control" type="text" readonly id="contact_phone" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="activity_id" value="@ViewBag.activity_id" />
@section scripts{
    <script>
        var KTSummernoteDemo = function () {
            var demos = function () {
                $('.summernote').summernote({
                    height: 100
                });
            }
            return {
                init: function () {
                    demos();
                }
            };
        }();
        jQuery(document).ready(function () {
            KTSummernoteDemo.init();
        });
    </script>
    <script>
        let id_edit_giai_doan = 0;
        let id_edit_tu_cach = 0;
        let id_edit_dong_to_chuc = 0;
        let id_edit_KP = 0;
        let id_edit_KPtypes = 0;
        var save_loader = new LoaderBtn($(".load-btn"));

        var uppyDuTruAdd;
        var uppyDuTruEdit;
        var uppyDieuChinhEdit;
        var uppyThucTeEdit;

        function calcuaTotal(id1, id2, id3) {
            let val = (parseFloat($(id1).val()) * parseFloat($(id2).val())).toLocaleString('en');
            if (val != 'NaN') {
                $(id3).val(val);
            } else {
                $(id3).val('0');
            }

        }
        function convertDate(date) {
            correctFormat = date.replace(/(\d+)\/(\d+)\/(\d+)/, "$3/$2/$1"),
                myDate = new Date(correctFormat);
            return myDate;
        }
        function clearModal(id) {
            $(id).find('input:text, input:password, select, a')
                .each(function () {
                    $(this).val('');
                });
        }
        function changeStatusActivity(id) {
            var object = {
                activity_id: document.getElementById('activity_id').value,
                status : id,
            }
            $.ajax({
                url: "@Url.Action("changeStatusAA", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        toastr.success(data);
                        if (id == 1) {
                            $('#remove_activity').attr('hidden', true);
                            $('#post_activity').attr('hidden', false);
                        } else {
                            $('#remove_activity').attr('hidden', false);
                            $('#post_activity').attr('hidden', true);
                        }
                        setTimeout(function () {
                            initDetail();
                        }, 1000);
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
            });
            return;
        }
        function setUpForm() {
            window.open("/DetailOfAcademicActivity/RegisterForm?pid=" + id_edit_giai_doan);
        }
        function viewThongKeDKTD() {
            filterSLby();
            $('#ThongKeDKTD').modal('show');
        }
        function filterSLby() {
            val = document.getElementById('filterSL').value;
            switch (val) {
                case 'CS':
                    var tableSL = $("#ThongKeSLDatatable").DataTable();
                    tableSL.column(0).visible(true);
                    var head_item = tableSL.columns(0).header();
                    $(head_item).html('Cơ sở');
                    tableSL.clear().draw();
                    $.ajax({
                        url: "@Url.Action("getStatisticOffice", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ activity_id: $('#activity_id').val()}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != null) {
                                data.forEach(function (x) {
                                    tableSL.row.add([x.title,x.dang_ky,x.tham_du]).draw();
                                });
                            }
                        },
                    });
                    break;
                case 'DV':
                    var tableSL = $("#ThongKeSLDatatable").DataTable();
                    tableSL.column(0).visible(true);
                    var head_item = tableSL.columns(0).header();
                    $(head_item).html('Đơn vị');
                    tableSL.clear().draw();
                    $.ajax({
                        url: "@Url.Action("getStatisticUnit", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ activity_id: $('#activity_id').val()}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != null) {
                                data.forEach(function (x) {
                                    tableSL.row.add([x.title,x.dang_ky,x.tham_du]).draw();
                                });
                            }
                        },
                    });
                    break;
                case 'DF':
                    var tableSL = $("#ThongKeSLDatatable").DataTable();
                    tableSL.column(0).visible(false);
                    tableSL.clear().draw();
                    $.ajax({
                        url: "@Url.Action("getTotal", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ activity_id: $('#activity_id').val()}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if(data != null)
                                tableSL.row.add(['', data.dang_ky, data.tham_du]).draw();
                            else
                                tableSL.row.add(['', 0, 0]).draw();
                        },
                    });
                    break;
            }
        }

        function clickAddPriceTuCach() {
            if (document.getElementById('add_price_tucach').value == 'MP') {
                $('#add_control_price').hide();
            } else
                $('#add_control_price').show();
        }

        function clickEditPriceTuCach() {
            if (document.getElementById('edit_price_tucach').value == 'MP') {
                $('#edit_control_price').hide();
            } else
                $('#edit_control_price').show();
        }

        let arrIndexDonvi = [];
        let numberOfIndexDonvi = 0;

        let arrIndexDonviEdit = [];
        let numberOfIndexDonviEdit = 0;

        let arrIndexContent = [];
        let numberOfIndexContent = 0;

        function bonusRowContent(index) {
            if (index == 0) {
                var ind = 0;
                if (arrIndexContent.length == 0) {
                    ind = numberOfIndexContent;
                    arrIndexContent.push(ind);
                    numberOfIndexContent = numberOfIndexContent + 1;
                } else {
                    ind = Math.max.apply(Math, arrIndexContent) + 1;
                    arrIndexContent.push(ind);
                }
                $('#subcontent-control').append(
                    "<div id=\"row-ckeditor-" + ind + "\" class=\"row\">" +
                    "<div class=\"col-sm-2 col-md-2 col-xl-2 col-lg-2 mt-5\">" +
                    "<input type=\"text\" class=\"form-control\" id=\"content-" + ind + "\" autocomplete=\"off\" />" +
                    "</div>" +
                    "<div class=\"col-sm-9 col-md-9 col-xl-9 col-lg-9 mt-5\">" +
                    "<div id=\"editor-subcontent-" + ind + "\" class=\"summernote\"></div>" +
                    "</div>" +
                    "<div class=\"col-sm-1 col-md-1 col-xl-1 col-lg-1 mt-5\">" +
                    "<button type=\"button\" class=\"btn btn-light-primary btn-sm px-6\" onclick=\"removeRowContent(" + ind + ")\">Xóa</button>" +
                    "</div>" +
                    "</div>");
            } else {
                arrIndexContent.push(index);
                $('#subcontent-control').append(
                    "<div id=\"row-ckeditor-" + index + "\" class=\"row\">" +
                    "<div class=\"col-sm-2 col-md-2 col-xl-2 col-lg-2 mt-5\">" +
                    "<input type=\"text\" class=\"form-control\" id=\"content-" + index + "\" autocomplete=\"off\" />" +
                    "</div>" +
                    "<div class=\"col-sm-9 col-md-9 col-xl-9 col-lg-9 mt-5\">" +
                    "<div id=\"editor-subcontent-" + index + "\" class=\"summernote\"></div>" +
                    "</div>" +
                    "<div class=\"col-sm-1 col-md-1 col-xl-1 col-lg-1 mt-5\">" +
                    "<button type=\"button\" class=\"btn btn-light-primary btn-sm px-6\" onclick=\"removeRowContent(" + index + ")\">Xóa</button>" +
                    "</div>" +
                    "</div>");
            }
            KTSummernoteDemo.init();
        }

        function removeRowContent(id) {
            $('#row-ckeditor-' + id).remove();
            arrIndexContent = arrIndexContent.filter(function (e) { return e !== id });
        }

        function bonusRow(index) {
            if (index == 0) {
                var ind = 0;
                if (arrIndexDonvi.length == 0) {
                    ind = numberOfIndexDonvi;
                    arrIndexDonvi.push(ind);
                    numberOfIndexDonvi = numberOfIndexDonvi + 1;
                } else {
                    ind = Math.max.apply(Math, arrIndexDonvi) + 1;
                    arrIndexDonvi.push(ind);
                }
                $('#add_control').append("<div class=\"row customrow\" id=\"row-" + ind + "\"><div class=\"col-md-6 col-xl-6 col-lg-6\"><select id=\"name_coso" + ind + "\" class=\"form-control\"></select>" +
                    "</div><div class=\"col-md-4 col-xl-4 col-lg-4\"><input type=\"number\" id=\"amount-" + ind + "\" class=\"form-control\" autocomplete=\"off\" placeholder=\"Số lượng\"></div><div class=\"col-md-2 col-xl-2 col-lg-2\">"+
                    "<a href =\"#\" class=\"btn-sm btn btn-primary\" onclick=\"removeRow(" + ind + ")\"><i class=\"fas fa-minus\" style=\"color:#ffffff;padding:0px !important\"></i></a></div></div>");
                genOffice('#name_coso' +ind);
            } else {
                arrIndexDonvi.push(index);
                $('#add_control').append("<div class=\"row customrow\" id=\"row-" + index + "\"><div class=\"col-md-6 col-xl-6 col-lg-6\"><select id=\"name_coso" + index + "\" class=\"form-control\"></select>" +
                    "</div><div class=\"col-md-4 col-xl-4 col-lg-4\"><input type=\"number\" id=\"amount-" + index + "\" class=\"form-control\" autocomplete=\"off\" placeholder=\"Số lượng\"></div><div class=\"col-md-2 col-xl-2 col-lg-2\">" +
                    "<a href =\"#\" class=\"btn-sm btn btn-primary\" onclick=\"removeRow(" + index + ")\"><i class=\"fas fa-minus\" style=\"color:#ffffff;padding:0px !important\"></i></a></div></div>");
                genOffice('#name_coso' +index);
            }
        }

        function removeRow(id) {
            $('#row-' + id).remove();
            arrIndexDonvi = arrIndexDonvi.filter(function (e) { return e !== id });
        }
        function bonusRowEdit(index) {
            if (index == 0) {
                var ind = 0;
                if (arrIndexDonviEdit.length == 0) {
                    ind = numberOfIndexDonviEdit;
                    arrIndexDonviEdit.push(ind);
                    numberOfIndexDonviEdit = numberOfIndexDonviEdit + 1;
                } else {
                    ind = Math.max.apply(Math, arrIndexDonviEdit) + 1;
                    arrIndexDonviEdit.push(ind);
                }
                $('#edit_control').append("<div class=\"row customrow\" id=\"rowedit-" + ind + "\"><div class=\"col-md-6 col-xl-6 col-lg-6\"><select id=\"name_coso_edit" + ind + "\" class=\"form-control\"></select>" +
                    "</div><div class=\"col-md-4 col-xl-4 col-lg-4\"><input type=\"number\" id=\"amountedit-" + ind + "\" class=\"form-control\" autocomplete=\"off\" placeholder=\"Số lượng\"></div><div class=\"col-md-2 col-xl-2 col-lg-2\">" +
                    "<a href =\"#\" class=\"btn-sm btn btn-primary\" onclick=\"removeRowEdit(" + ind + ")\"><i class=\"fas fa-minus\" style=\"color:#ffffff;padding:0px !important\"></i></a></div></div>");
                genOffice('#name_coso_edit' + ind);
            } else {
                arrIndexDonviEdit.push(index);
                $('#edit_control').append("<div class=\"row customrow\" id=\"rowedit-" + index + "\"><div class=\"col-md-6 col-xl-6 col-lg-6\"><select id=\"name_coso_edit" + index + "\" class=\"form-control\"></select>" +
                    "</div><div class=\"col-md-4 col-xl-4 col-lg-4\"><input type=\"number\" id=\"amountedit-" + index + "\" class=\"form-control\" autocomplete=\"off\" placeholder=\"Số lượng\"></div><div class=\"col-md-2 col-xl-2 col-lg-2\">" +
                    "<a href =\"#\" class=\"btn-sm btn btn-primary\" onclick=\"removeRowEdit(" + index + ")\"><i class=\"fas fa-minus\" style=\"color:#ffffff;padding:0px !important\"></i></a></div></div>");
                genOffice('#name_coso_edit' + index);
            }
        }

        function removeRowEdit(id) {
            $('#rowedit-' + id).remove();
            arrIndexDonviEdit = arrIndexDonviEdit.filter(function (e) { return e !== id });
        }
        function getContactInfo() {
            return;
        }
        function editGiaiDoan(id) {
            id_edit_giai_doan = id;
            var object = {
                language_id: document.getElementById('detail_language_content').value,
                phase_id : id
            };
            $.ajax({
                url: "@Url.Action("getDetailPhase", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    document.getElementById('edit_name_giaidoan').value = data.phase_name;
                    document.getElementById('edit_from_giaidoan').value = data.from;
                    document.getElementById('edit_to_giaidoan').value = data.to;
                    $('#editModal_Giaidoan').modal('show');
                    if (typeof datatableTC != 'undefined') {
                        datatableTC.ajax.reload();
                    } else
                        initDatatableTuCach();
                },
            });
        }
        function deleteGiaiDoan(id) {
            Swal.fire({
                title: "Bạn có muốn xóa giai đoạn này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deletePhase", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ phase_id: id }),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                toastr.success(data);
                                datatableGD.ajax.reload();
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại.');
                            }
                        },
                    });
                }
            });
        }
        function clickDonviTucachEdit() {
            if ($('#edit_donvi_tucach').prop('checked')) {
                $('#edit_control_title').show();
                $('#edit_control_btn').show();
                $('#edit_control').show();
                $('#edit_quantity_tucach').attr('disabled', true);
            } else {
                $('#edit_control_title').hide();
                $('#edit_control_btn').hide();
                $('#edit_control').hide();
                $('#edit_quantity_tucach').attr('disabled', false);
            }
        }

        function editTuCach(id) {
            document.getElementById('edit_control').innerHTML = '';
            document.getElementById('edit_quantity_tucach').value = '';
            numberOfIndexDonviEdit = 0;
            arrIndexDonviEdit = [];
            id_edit_tu_cach = id;
            $.ajax({
                url: "@Url.Action("getParticipantPlanByRole", "DetailOfAcademicActivity")",
                data: JSON.stringify({ participant_role_id: id }),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    document.getElementById('edit_name_tucach').value = data.role.participant_role_name;
                    if (data.role.price != null) {
                        document.getElementById('edit_price_tucach').value = 'CP';
                        document.getElementById('edit_cost_tucach').value = data.role.price;
                    } else {
                        document.getElementById('edit_price_tucach').value = 'MP';
                        $('#edit_control_price').hide();
                    }
                    if (data.offices.length == 1 && data.offices[0].office_id == null) {
                        $('#edit_donvi_tucach').prop('checked', false);
                        document.getElementById('edit_quantity_tucach').value = data.offices[0].quantity;
                        clickDonviTucachEdit();
                    } else {
                        $('#edit_donvi_tucach').prop('checked', true);
                        clickDonviTucachEdit();
                        data.offices.forEach(function (x) {
                            bonusRowEdit(x.office_id);
                            document.getElementById('amountedit-' + x.office_id).value = x.quantity;
                            document.getElementById('name_coso_edit' + x.office_id).value = x.office_id;
                        });
                    }
                    $('#editModal_Tucach').modal('show');
                },
            });
        }
        function deleteTuCach(id) {
            Swal.fire({
                title: "Bạn có muốn xóa tư cách này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deleteParticipantRole", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ participant_role_id : id }),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                toastr.success(data);
                                if (typeof datatableTC != 'undefined') {
                                    datatableTC.ajax.reload();
                                } else
                                    initDatatableTuCach();
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                            }
                        },
                    });
                }
            });
        }

        $(document).on('click', '#btn_delete_DongToChuc', function () {
            let activity_partner_id = $(this).data('id');
            Swal.fire({
                title: "Bạn có muốn xóa đơn vị này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: '/DetailOfAcademicActivity/deleteActivityPartner',
                        type: "POST",
                        data: { activity_partner_id: activity_partner_id },
                        success: function (data) {
                            if (data.success) {
                                DongTochucDatatable.ajax.reload();
                                Swal.fire(data.title, data.content, "success");
                            } else {
                                Swal.fire(data.title, data.content, "error");
                            }
                        },
                        error: function () {
                            Swal.fire("Thất bại", "Có lỗi khi xóa", "error");
                        }
                    });
                }
            });
        });
        function deleteKinhPhi(id) {
            Swal.fire({
                title: "Bạn có muốn xóa mục kinh phí này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deleteExpense", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ activity_office_id: id }),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                toastr.success(data);
                                datatableKP.ajax.reload();
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                            }
                        }
                    });
                }
            });
        }

        function KPDuTru(id) {
            id_edit_KP = id;
            if (typeof datatableKPDuTru != 'undefined') {
                datatableKPDuTru.ajax.reload();
            } else
                initDatatableKPDuTru();
            $('#KPDuTruModal').modal('show');
        }
        function deleteKinhPhiDuTru(id) {
            Swal.fire({
                title: "Bạn có muốn xóa mục kinh phí dự trù này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deleteExpenseType", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ expense_category_id: id,type : 1}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                if (typeof datatableKPDuTru != 'undefined') {
                                    datatableKPDuTru.ajax.reload();
                                } else
                                    initDatatableKPDuTru();
                                datatableKP.ajax.reload();
                                toastr.success('Xóa mục kinh phí dự trù thành công');
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                            }
                        },
                    });
                }
            });
        }
        function editKinhPhiDuTru(id) {
            id_edit_KPtypes = id;
            $.ajax({
                url: "@Url.Action("getExpenseType", "DetailOfAcademicActivity")",
                data: JSON.stringify({ expense_category_id : id,type : 1}),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $('#edit_noidung_kpDuTru').val(data.expense_category_name);
                    $('#edit_dongia_kpDuTru').val(data.expense_price);
                    $('#edit_soluong_kpDuTru').val(data.expense_quantity);
                    $('#edit_thanhtien_kpDuTru').val(data.total.toLocaleString('en'));
                    $('#edit_ghichu_kpDuTru').val(data.note);
                    if (data.link != null) {
                        document.getElementById('edit_dinhkem_kpDuTru').innerHTML = data.name;
                        $('#edit_dinhkem_kpDuTru').attr('href', data.link);
                        $('#edit_dinhkem_kpDuTru').attr('target','_blank');
                    } else {
                        document.getElementById('edit_dinhkem_kpDuTru').innerHTML = 'Chưa có file đính kèm';
                        $('#edit_dinhkem_kpDuTru').attr('href', 'javascript:;');
                        $('#edit_dinhkem_kpDuTru').removeAttr('target');
                    }
                    $('#editModal_KPDuTru').modal('show');
                },
            });
        }
        function KPDieuChinh(id) {
            id_edit_KP = id;
            if (typeof datatableKPDieuChinh != 'undefined') {
                datatableKPDieuChinh.ajax.reload();
            } else
                initDatatableKPDieuChinh();
            $('#KPDieuChinhModal').modal('show');
        }
        function editKinhPhiDieuChinh(id) {
            id_edit_KPtypes = id;
            $.ajax({
                url: "@Url.Action("getExpenseType", "DetailOfAcademicActivity")",
                data: JSON.stringify({ expense_category_id : id,type : 2}),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $('#edit_noidung_kpDieuChinh').val(data.expense_category_name);
                    $('#edit_dongia_kpDieuChinh').val(data.expense_price == null ? '' : data.expense_price);
                    $('#edit_soluong_kpDieuChinh').val(data.expense_quantity == null ? '' : data.expense_quantity);
                    $('#edit_thanhtien_kpDieuChinh').val(data.total == null ? '0' : data.total.toLocaleString('en'));
                    $('#edit_ghichu_kpDieuChinh').val(data.note == null ? '' : data.note);
                    if (data.link != null) {
                        document.getElementById('edit_dinhkem_kpDieuChinh').innerHTML = data.name;
                        $('#edit_dinhkem_kpDieuChinh').attr('href', data.link);
                        $('#edit_dinhkem_kpDieuChinh').attr('target', '_blank');
                    }
                    else {
                        document.getElementById('edit_dinhkem_kpDieuChinh').innerHTML = 'Chưa có file đính kèm';
                        $('#edit_dinhkem_kpDieuChinh').attr('href', 'javascript:;');
                        $('#edit_dinhkem_kpDieuChinh').removeAttr('target');
                    }
                    $('#editModal_KPDieuChinh').modal('show');
                },
                error: function (data) {
                }
            });
        }
        function deleteKinhPhiDieuChinh(id) {
            Swal.fire({
                title: "Bạn có muốn xóa mục kinh phí điều chỉnh này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deleteExpenseType", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ expense_category_id: id, type : 2}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                if (typeof datatableKPDieuChinh != 'undefined') {
                                    datatableKPDieuChinh.ajax.reload();
                                } else
                                    initDatatableKPDieuChinh();
                                datatableKP.ajax.reload();
                                toastr.success('Xóa mục kinh phí điều chỉnh thành công');
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                            }
                        },
                    });
                }
            });
        }
        function KPThucTe(id) {
            id_edit_KP = id;
            if (typeof datatableKPThucTe != 'undefined') {
                datatableKPThucTe.ajax.reload();
            } else
                initDatatableKPThucTe();
            $('#KPThucTeModal').modal('show');
        }
        function editKinhPhiThucTe(id) {
            id_edit_KPtypes = id;
            $.ajax({
                url: "@Url.Action("getExpenseType", "DetailOfAcademicActivity")",
                data: JSON.stringify({ expense_category_id : id,type : 3}),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $('#edit_noidung_kpThucTe').val(data.expense_category_name);
                    $('#edit_dongia_kpThucTe').val(data.expense_price == null ? '' : data.expense_price);
                    $('#edit_soluong_kpThucTe').val(data.expense_quantity == null ? '' : data.expense_quantity);
                    $('#edit_thanhtien_kpThucTe').val(data.total == null ? '0' : data.total.toLocaleString('en'));
                    $('#edit_ghichu_kpThucTe').val(data.note == null ? '' : data.note);
                    if (data.link != null) {
                        document.getElementById('edit_dinhkem_kpThucTe').innerHTML = data.name;
                        $('#edit_dinhkem_kpThucTe').attr('href', data.link);
                        $('#edit_dinhkem_kpThucTe').attr('target', '_blank');
                    }
                    else {
                        document.getElementById('edit_dinhkem_kpThucTe').innerHTML = 'Chưa có file đính kèm';
                        $('#edit_dinhkem_kpThucTe').attr('href', 'javascript:;');
                        $('#edit_dinhkem_kpThucTe').removeAttr('target');
                    }
                    $('#editModal_KPThucTe').modal('show');
                },
                error: function (data) {
                }
            });
        }
        function deleteKinhPhiThucTe(id) {
            Swal.fire({
                title: "Bạn có muốn xóa mục kinh phí thực tế này không ?",
                text: "",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "@Url.Action("deleteExpenseType", "DetailOfAcademicActivity")",
                        data: JSON.stringify({ expense_category_id: id, type : 3}),
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        success: function (data) {
                            if (data != '') {
                                if (typeof datatableKPThucTe != 'undefined') {
                                    datatableKPThucTe.ajax.reload();
                                } else
                                    initDatatableKPThucTe();
                                datatableKP.ajax.reload();
                                toastr.success('Xóa mục kinh phí thực tế thành công');
                            } else {
                                toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                            }
                        },
                    });
                }
            });
        }

        $('#btn_add_giaidoan').click(function () {
            var basePhase = {
                phase_name: document.getElementById('add_name_giaidoan').value,
                from: document.getElementById('add_from_giaidoan').value,
                to: document.getElementById('add_to_giaidoan').value
            };
            if (convertDate(basePhase.from).getTime() > convertDate(basePhase.to).getTime()) {
                toastr.warning("Thời hạn bắt đầu không thể sau thời hạn kết thúc");
                return false;
            }
            var form_data = datatableGD.rows().data();
            let checkout = false;
            for (let i = 0; i < form_data.length; i++) {
                if ((convertDate(basePhase.to).getTime() >= convertDate(form_data[i].from).getTime() && convertDate(basePhase.to).getTime() < convertDate(form_data[i].to).getTime())
                    || (convertDate(basePhase.from).getTime() >= convertDate(form_data[i].from).getTime() && convertDate(basePhase.to).getTime() <= convertDate(form_data[i].to).getTime())
                    || (convertDate(basePhase.from).getTime() <= convertDate(form_data[i].to).getTime() && convertDate(basePhase.to).getTime() > convertDate(form_data[i].to).getTime())) {
                    checkout = true;
                }
            }
            if (checkout) {
                toastr.warning('Thời gian diễn ra các giai đoạn không thể trùng nhau');
                return false;
            }
            var object = {
                language_id: document.getElementById('detail_language_content').value,
                activity_id: document.getElementById('activity_id').value,
                basePhase: basePhase
            };
            $.ajax({
                url: "@Url.Action("addPhase", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        datatableGD.ajax.reload();
                        clearModal('#addModal_Giaidoan');
                        $('#addModal_Giaidoan').modal('hide');
                        toastr.success(data);
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
            });
        });

        //best of DuaHau
        @*DONG TO CHUC*@
        @*ADD MODAL*@
        $('#add_donvi_DongToChuc').select2({
            placeholder: 'Đơn vị đào tạo',
            allowClear: true,
            ajax: {
                url: '/AcademicCollaboration/getPartners',
                delay: 250,
                cache: true,
                dataType: 'json',
                data: function (params) {
                    return {
                        partner_name: params.term
                    };
                },
                processResults: function (data) {
                    data.obj.map(function (obj) {
                        obj.id = obj.partner_id;
                        obj.text = obj.partner_name;
                        return data.obj;
                    });

                    return {
                        results: data.obj
                    };
                }
            },
            templateResult: formatPartnerInfo
        });

        function formatPartnerInfo(partner) {
            if (partner.id) {
                let partner_name = partner.partner_name;
                if (isEmptyOrNullOrUndefined(partner_name)) {
                    return "Dữ liệu đơn vị đào tạo mới."
                } else {
                    return partner.partner_name;
                }
            }
        }

        $('#add_phamvihoptac_DongToChuc').select2({
            placeholder: 'Phạm vi hợp tác',
            allowClear: true,
            minimumResultsForSearch: -1, //hide search box
            ajax: {
                url: '/AcademicCollaboration/getCollabScopes',
                delay: 250,
                cache: true,
                dataType: 'json',
                data: function () {
                    return {
                        collab_abbreviation_name: 'JC' //Joint conference, workshop, seminar, ...
                    };
                },
                processResults: function (data) {
                    data.obj.map(function (obj) {
                        obj.id = obj.scope_id;
                        obj.text = obj.scope_name;
                        return data.obj;
                    });

                    return {
                        results: data.obj
                    };
                }
            },
            templateResult: formatCollabScope
        });

        function formatCollabScope(scope) {
            return scope.scope_abbreviation + " - " + scope.scope_name;
        }

        var uppy1;

        function isEmptyOrNullOrUndefined(value) {
            if (value === null || value === undefined || value === "") {
                return true;
            }
            return false;
        }

        function datePickerFromToValidate(from, to) {
            if (!(from === "" || to === "")) {
                let date_from = Date.parse(formatDatePicker(from));
                let date_to = Date.parse(formatDatePicker(to));
                if (date_from > date_to) {
                    return false;
                }
                return true;
            }
            return true;
        }

        function formatDatePicker(date) {
            if (date != '') {
                return date.split('/')[2] + '/' + date.split('/')[1] + '/' + date.split('/')[0];
            }
        }

        function objActivityPartner(activity_partner_id, activity_id, partner_id, scope_id, sponsor, cooperation_date_start, cooperation_date_end,
            contact_point_name, contact_point_email, contact_point_phone) {
            let obj_activity_scope = {};
            obj_activity_scope.activity_partner_id = activity_partner_id;
            obj_activity_scope.activity_id = activity_id;
            obj_activity_scope.partner_id = partner_id;
            obj_activity_scope.scope_id = scope_id;
            if (!isEmptyOrNullOrUndefined(sponsor)) obj_activity_scope.sponsor = sponsor;
            if (!isEmptyOrNullOrUndefined(cooperation_date_start)) obj_activity_scope.cooperation_date_start = formatDatePicker(cooperation_date_start);
            if (!isEmptyOrNullOrUndefined(cooperation_date_end)) obj_activity_scope.cooperation_date_end = formatDatePicker(cooperation_date_end);
            if (!isEmptyOrNullOrUndefined(contact_point_name)) obj_activity_scope.contact_point_name = contact_point_name;
            if (!isEmptyOrNullOrUndefined(contact_point_email)) obj_activity_scope.contact_point_email = contact_point_email;
            if (!isEmptyOrNullOrUndefined(contact_point_phone)) obj_activity_scope.contact_point_phone = contact_point_phone;
            return obj_activity_scope;
        }

        function clearActivityPartnerContentAddModal() {
            $('#add_donvi_DongToChuc').val(null).trigger('change');
            $('#add_phamvihoptac_DongToChuc').val(null).trigger('change');
            $('#add_taitro_DongToChuc').val('');
            $('#add_from_DongToChuc').val('');
            $('#add_to_DongToChuc').val('');
            $('.uppy-list').html('');
            uppy1.removeFile(uppy1.getFiles().length == 0 ? '' : uppy1.getFiles()[0].id);
            $('#add_name_DongToChuc').val('');
            $('#add_email_DongToChuc').val('');
            $('#add_phone_DongToChuc').val('');
        }

        let btn_add_save_DongToChuc = new LoaderBtn($("#btn_add_save_DongToChuc"));
        //ADD MODAL SAVE EVENT
        $('#btn_add_save_DongToChuc').click(function () {

            let activity_id = $('#activity_id').val();
            let partner_id = $('#add_donvi_DongToChuc').val();
            let partner_name = $('#add_donvi_DongToChuc option:selected').text();
            let scope_id = $('#add_phamvihoptac_DongToChuc').val();
            let sponsor = $('#add_taitro_DongToChuc').val();
            let cooperation_date_start = $('#add_from_DongToChuc').val();
            let cooperation_date_end = $('#add_to_DongToChuc').val();

            let evidence_file = uppy1.getFiles();
            let contact_point_name = $('#add_name_DongToChuc').val();
            let contact_point_email = $('#add_email_DongToChuc').val();
            let contact_point_phone = $('#add_phone_DongToChuc').val();

            if (isEmptyOrNullOrUndefined(partner_id) || isEmptyOrNullOrUndefined(scope_id)) {
                return toastr.error("Chưa chọn đủ trường thông tin bắt buộc.");
            } else {
                if (!datePickerFromToValidate(cooperation_date_start, cooperation_date_end)) {
                    return toastr.error("Thời hạn bắt đầu không được vượt quá thời hạn kết thúc.");
                } else {
                    let obj_activity_partner = objActivityPartner(0, activity_id, partner_id, scope_id, sponsor, cooperation_date_start, cooperation_date_end,
                        contact_point_name, contact_point_email, contact_point_phone);
                    let formData = new FormData();
                    formData.append("evidence_file", evidence_file.length == 0 ? null : evidence_file[0].data);
                    formData.append("folder_name", partner_name);
                    formData.append("obj_activity_partner_stringify", JSON.stringify(obj_activity_partner));

                    btn_add_save_DongToChuc.startLoading();
                    //Save actually
                    $.ajax({
                        url: "/DetailOfAcademicActivity/saveActivityPartner",
                        type: "POST",
                        data: formData,
                        cache: false,
                        dataType: "json",
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            if (data.success) {
                                toastr.success(data.content);
                                DongTochucDatatable.ajax.reload();
                                $("#btn_add_close_DongToChuc").click();
                                clearActivityPartnerContentAddModal();
                                btn_add_save_DongToChuc.stopLoading();
                            } else {
                                toastr.warning(data.content);
                                btn_add_save_DongToChuc.stopLoading();
                            }
                        },
                        error: function () {
                            toastr.error("Có lỗi xảy ra.");
                            btn_add_save_DongToChuc.stopLoading();
                        }
                    });
                }
            }
        });

        @*EDIT MODAL*@
        $('#edit_donvi_DongToChuc').select2({
            placeholder: 'Đơn vị đào tạo',
            allowClear: true,
            ajax: {
                url: '/AcademicCollaboration/getPartners',
                delay: 250,
                cache: true,
                dataType: 'json',
                data: function (params) {
                    return {
                        partner_name: params.term
                    };
                },
                processResults: function (data) {
                    data.obj.map(function (obj) {
                        obj.id = obj.partner_id;
                        obj.text = obj.partner_name;
                        return data.obj;
                    });

                    return {
                        results: data.obj
                    };
                }
            },
            templateResult: formatPartnerInfo
        });

        $('#edit_phamvihoptac_DongToChuc').select2({
            placeholder: 'Phạm vi hợp tác',
            allowClear: true,
            minimumResultsForSearch: -1, //hide search box
            ajax: {
                url: '/AcademicCollaboration/getCollabScopes',
                delay: 250,
                cache: true,
                dataType: 'json',
                data: function () {
                    return {
                        collab_abbreviation_name: 'JC' //Joint conference, workshop, seminar, ...
                    };
                },
                processResults: function (data) {
                    data.obj.map(function (obj) {
                        obj.id = obj.scope_id;
                        obj.text = obj.scope_name;
                        return data.obj;
                    });

                    return {
                        results: data.obj
                    };
                }
            },
            templateResult: formatCollabScope
        });

        var activity_partner_id;
        var uppy2;
        $('#editModal_DongToChuc').on('show.bs.modal', function (e) {
            activity_partner_id = $(e.relatedTarget).data('id');
            console.log(activity_partner_id);
            $.ajax({
                url: "/DetailOfAcademicActivity/getActivityPartner",
                type: "GET",
                data: {
                    activity_partner_id: activity_partner_id
                },
                cache: false,
                dataType: "json",
                success: function (data) {
                    if (data.obj != null) {
                        if (data.success) {
                            let objData = data.obj;
                            $('#edit_donvi_DongToChuc').append(new Option(objData.partner_name, objData.partner_id, false, true)).trigger('change');
                            $('#edit_phamvihoptac_DongToChuc').append(new Option(objData.scope_abbreviation + " - " + objData.scope_name, objData.scope_id, false, true)).trigger('change');
                            $('#edit_taitro_DongToChuc').val(objData.sponsor);
                            if (!isEmptyOrNullOrUndefined(objData.cooperation_date_start)) $('#edit_from_DongToChuc').val(moment(objData.cooperation_date_start).format("DD/MM/YYYY"));
                            if (!isEmptyOrNullOrUndefined(objData.cooperation_date_end)) $('#edit_to_DongToChuc').val(moment(objData.cooperation_date_end).format("DD/MM/YYYY"));
                            let file_content = '';
                            if (objData.file_id == null) {
                                file_content = 'Chưa có bản mềm.';
                            } else {
                                file_content = objData.file_name;
                            }
                            console.log(objData);
                            $("#edit_banmem_DongToChuc #edit_DongToChuc_file_content_upload").append(
                                `<a class="form-control" style="text-overflow: ellipsis; overflow: hidden; 
                                white-space: nowrap;" target="_blank" href="` + objData.file_link + `"><span>` + file_content + `</span></a>`);
                            $('#edit_name_DongToChuc').val(objData.contact_point_name);
                            $('#edit_email_DongToChuc').val(objData.contact_point_email);
                            $('#edit_phone_DongToChuc').val(objData.contact_point_phone);
                        }
                    } else {
                        toastr.error(data.content);
                    }
                },
                error: function () {
                    toastr.error("Có lỗi xảy ra.");
                }
            });
        });

        $('#editModal_DongToChuc').on('hide.bs.modal', function () {
            clearContentCollabPartnerModalEdit();
        });

        function clearContentCollabPartnerModalEdit() {
            $('#edit_donvi_DongToChuc').val(null).trigger('change');
            $('#edit_phamvihoptac_DongToChuc').val(null).trigger('change');
            $('#edit_taitro_DongToChuc').val('');
            $('#edit_from_DongToChuc').val('');
            $('#edit_to_DongToChuc').val('');
            //clear upload file
            $("#edit_banmem_DongToChuc #edit_DongToChuc_file_content_upload").html('');
            $('#edit_banmem_DongToChuc .uppy-list').html('');
            uppy2.removeFile(uppy2.getFiles().length == 0 ? '' : uppy2.getFiles()[0].id);
            $('#edit_name_DongToChuc').val('');
            $('#edit_email_DongToChuc').val('');
            $('#edit_phone_DongToChuc').val('');
        }
        //aa
        $('#btn_edit_giaidoan').click(function () {
            var data = {
                phase_id: id_edit_giai_doan,
                full_name: '',
                phase_name: document.getElementById('edit_name_giaidoan').value,
                from: document.getElementById('edit_from_giaidoan').value,
                to: document.getElementById('edit_to_giaidoan').value
            };
            if (convertDate(data.from).getTime() > convertDate(data.to).getTime()) {
                toastr.warning("Thời hạn bắt đầu không thể sau thời hạn kết thúc");
                return false;
            }
            var form_data = datatableGD.rows().data();
            let checkout = false;
            for (let i = 0; i < form_data.length; i++) {
                if (data.phase_id != form_data[i].phase_id) {
                    if ((convertDate(data.to).getTime() >= convertDate(form_data[i].from).getTime() && convertDate(data.to).getTime() < convertDate(form_data[i].to).getTime())
                        || (convertDate(data.from).getTime() >= convertDate(form_data[i].from).getTime() && convertDate(data.to).getTime() <= convertDate(form_data[i].to).getTime())
                        || (convertDate(data.from).getTime() <= convertDate(form_data[i].to).getTime() && convertDate(data.to).getTime() > convertDate(form_data[i].to).getTime())) {
                        checkout = true;
                    }
                }
            }
            if (checkout) {
                toastr.warning('Thời gian diễn ra các giai đoạn không thể trùng nhau');
                return false;
            }
            var obj = {
                language_id: document.getElementById('detail_language_content').value,
                data: data
            };
            $.ajax({
                url: "@Url.Action("editPhase", "DetailOfAcademicActivity")",
                data: JSON.stringify(obj),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        toastr.success(data);
                        datatableGD.ajax.reload();
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                }
            });
        });

        let btn_edit_save_DongToChuc = new LoaderBtn($('#btn_edit_save_DongToChuc'));
        $('#btn_edit_save_DongToChuc').click(function () {
            let activity_id = $('#activity_id').val();
            let partner_id = $('#edit_donvi_DongToChuc').val();
            let partner_name = $('#edit_donvi_DongToChuc option:selected').text();
            let scope_id = $('#edit_phamvihoptac_DongToChuc').val();
            let sponsor = $('#edit_taitro_DongToChuc').val();
            let cooperation_date_start = $('#edit_from_DongToChuc').val();
            let cooperation_date_end = $('#edit_to_DongToChuc').val();

            let evidence_file = uppy2.getFiles();
            let contact_point_name = $('#edit_name_DongToChuc').val();
            let contact_point_email = $('#edit_email_DongToChuc').val();
            let contact_point_phone = $('#edit_phone_DongToChuc').val();

            if (isEmptyOrNullOrUndefined(partner_id) || isEmptyOrNullOrUndefined(scope_id)) {
                return toastr.error("Chưa chọn đủ trường thông tin bắt buộc.");
            } else {
                if (!datePickerFromToValidate(cooperation_date_start, cooperation_date_end)) {
                    return toastr.error("Thời hạn bắt đầu không được vượt quá thời hạn kết thúc.");
                } else {
                    let obj_activity_partner = objActivityPartner(activity_partner_id, activity_id, partner_id, scope_id, sponsor, cooperation_date_start, cooperation_date_end,
                        contact_point_name, contact_point_email, contact_point_phone);
                    let formData = new FormData();
                    formData.append("evidence_file", evidence_file.length == 0 ? null : evidence_file[0].data);
                    formData.append("folder_name", partner_name);
                    formData.append("obj_activity_partner_stringify", JSON.stringify(obj_activity_partner));

                    btn_edit_save_DongToChuc.startLoading();
                    //Save actually
                    $.ajax({
                        url: "/DetailOfAcademicActivity/updateActivityPartner",
                        type: "POST",
                        data: formData,
                        cache: false,
                        dataType: "json",
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            if (data.success) {
                                toastr.success(data.content);
                                DongTochucDatatable.ajax.reload();
                                btn_edit_save_DongToChuc.stopLoading();
                            } else {
                                toastr.warning(data.content);
                                btn_edit_save_DongToChuc.stopLoading();
                            }
                        },
                        error: function () {
                            toastr.error("Có lỗi xảy ra.");
                            btn_edit_save_DongToChuc.stopLoading();
                        }
                    });
                }
            }
        });

        $('#btn_delete_giaidoan').click(function () {
            $.ajax({
                url: '/DetailOfAcademicActivity/delete_Phase',
                data: { 'id': id_delete_giai_doan },
                success: function (data) {
                    if (data.code = 1) {
                        toastr.success(data.err_content);
                    } else {
                        toastr.error(data.err_content);
                    }
                },
            });
        });
        function clickDonviTucachAdd() {
            if ($('#add_donvi_tucach').prop('checked')) {
                $('#add_control_title').show();
                $('#add_control_btn').show();
                $('#add_control').show();
                $('#add_quantity_tucach').attr('disabled', true)
            } else {
                $('#add_control_title').hide();
                $('#add_control_btn').hide();
                $('#add_control').hide();
                $('#add_quantity_tucach').attr('disabled', false)
            }
        }
        $('#btn_add_tucach').click(function () {
            let arrOffice = [];
            let arrCheck = [];
            let price;
            let check = false;
            let check2 = false;
            if ($('#add_price_tucach').val() == 'CP') {
                price = $('#add_cost_tucach').val();
            } else {
                price = -1;
            }
            if ($('#add_donvi_tucach').prop('checked')) {
                arrIndexDonvi.forEach(function (x) {
                    var obj = {
                        office_id: $('#name_coso' + x).val(),
                        quantity: $('#amount-' + x).val()
                    };
                    if (arrCheck.includes(obj.office_id)) {
                        check2 = true;
                        return;
                    } else {
                        arrCheck.push(obj.office_id);
                    }
                    if (obj.quantity == '') {
                        check = true;
                    }
                    arrOffice.push(obj);
                });
            }
            if (check == true || price == '' || (document.getElementById('add_quantity_tucach').value == '' && $('#add_donvi_tucach').prop('checked') == false) || $('#add_price_tucach').val() == null) {
                toastr.warning('Bạn chưa điền hết các trường thông tin.');
                return false;
            }
            if (check2) {
                toastr.warning('Không thể trùng cơ sở trong một tư cách tham gia.');
                return false;
            }
            var baseParticipantRole = {
                participant_role_id: 1,
                participant_role_name: document.getElementById('add_name_tucach').value,
                price: price
            };
            var object = {
                baseParticipantRole: baseParticipantRole,
                arrOffice: arrOffice,
                check: $('#add_donvi_tucach').prop('checked'),
                quantity: document.getElementById('add_quantity_tucach').value,
                phase_id: id_edit_giai_doan
            };
            $.ajax({
                url: "@Url.Action("addParticipantRole", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        toastr.success(data);
                        clearModal('#addModal_Tucach');
                        document.getElementById('add_quantity_tucach').value = '';
                        document.getElementById('add_cost_tucach').value = '';
                        if (typeof datatableTC != 'undefined') {
                            datatableTC.ajax.reload();
                        } else
                            initDatatableTuCach();
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
            });
        });
        $('#btn_edit_tucach').click(function () {
            let arrOffice = [];
            let arrCheck = [];
            let price;
            let check = false;
            let check2 = false;
            if ($('#edit_price_tucach').val() == 'CP') {
                price = $('#edit_cost_tucach').val();
            } else {
                price = -1;
            }
            if ($('#edit_donvi_tucach').prop('checked')) {
                arrIndexDonviEdit.forEach(function (x) {
                    var obj = {
                        office_id: $('#name_coso_edit' + x).val(),
                        quantity: $('#amountedit-' + x).val()
                    };
                    if (arrCheck.includes(obj.office_id)) {
                        check2 = true;
                        return;
                    } else {
                        arrCheck.push(obj.office_id);
                    }
                    if (obj.quantity == '') {
                        check = true;
                        return;
                    }
                    arrOffice.push(obj);
                });
            }
            if (check == true || price == '' || document.getElementById('edit_quantity_tucach').value == '') {
                toastr.warning('Bạn chưa điền hết các trường thông tin.');
                return false;
            }
            if (check2) {
                toastr.warning('Không thể trùng cơ sở trong một tư cách tham gia.');
                return false;
            }
            var baseParticipantRole = {
                participant_role_id: id_edit_tu_cach,
                participant_role_name: document.getElementById('edit_name_tucach').value,
                price: price
            };
            var object = {
                baseParticipantRole: baseParticipantRole,
                arrOffice: arrOffice,
                check: $('#edit_donvi_tucach').prop('checked'),
                quantity: document.getElementById('edit_quantity_tucach').value,
                phase_id: id_edit_giai_doan
            };
            $.ajax({
                url: "@Url.Action("editParticipantRole", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        toastr.success(data);
                        clearModal('#editModal_Tucach');
                        if (typeof datatableTC != 'undefined') {
                            datatableTC.ajax.reload();
                        } else
                            initDatatableTuCach();
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
            });
        });
        $('#btn_edit_kinhphi').click(function () {
            toastr.success("Đã chỉnh sửa thành công");
        });
        $('#btn_add_kinhphi').click(function () {
            var object = {
                activity_id: $('#activity_id').val(),
                office_id: $('#add_donvi_kinhphi').val()
            };
            $.ajax({
                url: "@Url.Action("addExpense", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data == 'Thêm mục kinh phí thành công.') {
                        toastr.success(data);
                        clearModal('#addModal_KinhPhi');
                        datatableKP.ajax.reload();
                    } else if (data == 'Không thể thêm đơn vị đã tồn tại.'){
                        toastr.warning(data);
                    }else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
            });
        });
        //aaaa
        $('#btn_add_kpDuTru').click(function () {
            save_loader.startLoading();
            var object = {
                expense_category_id : 0,
                expense_category_name: $('#add_noidung_kpDuTru').val(),
                expense_price: $('#add_dongia_kpDuTru').val(),
                expense_quantity: $('#add_soluong_kpDuTru').val(),
                total : 0,
                note: $('#add_ghichu_kpDuTru').val(),
                link : ''
            };
            if (object.expense_category_name == '' || object.expense_price == '' || object.expense_quantity == '') {
                toastr.warning("Bạn chưa điền hết các trường thông tin.");
                save_loader.stopLoading();
                return false;
            }
            var obj = new FormData();
            obj.append('activity_office_id', id_edit_KP);
            obj.append('activity_name', $('#detail_name').val());
            obj.append('data', JSON.stringify(object));

            let files = uppyDuTruAdd.getFiles();
            if (files.length != 0) {
                obj.append('img', uppyDuTruAdd.getFiles()[0].data)
            } else {
                obj.append('img', null);
            }
            $.ajax({
                url: "@Url.Action("addExpenseDuTru", "DetailOfAcademicActivity")",
                data: obj,
                type: "POST",
                success: function (data) {
                    if (data != '') {
                        toastr.success('Thêm kinh phí dự trù thành công.');
                        clearModal('#addModal_KPDuTru');
                        $('#addModal_KPDuTru').modal('hide');
                        uppyDuTruAdd.removeFile(uppyDuTruAdd.getFiles().length == 0 ? '' : uppyDuTruAdd.getFiles()[0].id);
                        $('#kt_uppy_addKPDuTru .uppy-list').html('');
                        if (typeof datatableKPDuTru != 'undefined') {
                            datatableKPDuTru.ajax.reload();
                        } else
                            initDatatableKPDuTru();
                        datatableKP.ajax.reload();
                    } else {
                        uppyDuTruAdd.removeFile(uppyDuTruAdd.getFiles().length == 0 ? '' : uppyDuTruAdd.getFiles()[0].id);
                        $('#kt_uppy_addKPDuTru .uppy-list').html('');
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                    save_loader.stopLoading();
                },
                error: function (data) {
                    uppyDuTruAdd.removeFile(uppyDuTruAdd.getFiles().length == 0 ? '' : uppyDuTruAdd.getFiles()[0].id);
                    $('#kt_uppy_addKPDuTru .uppy-list').html('');
                    save_loader.stopLoading();
                },
                dataType: "json",
                processData: false,
                contentType: false
            });
        });
        //aa
        $('#btn_edit_kpDuTru').click(function () {
            save_loader.startLoading();
            var object = {
                expense_category_id: id_edit_KPtypes,
                expense_category_name: $('#edit_noidung_kpDuTru').val(),
                expense_price: $('#edit_dongia_kpDuTru').val(),
                expense_quantity: $('#edit_soluong_kpDuTru').val(),
                total : 0,
                note: $('#edit_ghichu_kpDuTru').val(),
                link : ''
            };
            if (object.expense_category_name == '' || object.expense_price == '' || object.expense_quantity == '') {
                toastr.warning("Bạn chưa điền hết các trường thông tin.");
                save_loader.stopLoading();
                return false;
            }
            var obj = new FormData();
            obj.append('activity_office_id', id_edit_KP);
            obj.append('activity_name', $('#detail_name').val());
            obj.append('data', JSON.stringify(object));

            let files = uppyDuTruEdit.getFiles();
            if (files.length != 0) {
                obj.append('img', uppyDuTruEdit.getFiles()[0].data)
            } else {
                obj.append('img', null);
            }
            $.ajax({
                url: "@Url.Action("editExpenseDuTru", "DetailOfAcademicActivity")",
                data: obj,
                type: "POST",
                success: function (data) {
                    if (data != '') {
                        toastr.success('Chỉnh sửa kinh phí dự trù thành công.');
                        uppyDuTruEdit.removeFile(uppyDuTruEdit.getFiles().length == 0 ? '' : uppyDuTruEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPDuTru .uppy-list').html('');
                        clearModal('#editModal_KPDuTru');
                        $('#editModal_KPDuTru').modal('hide');
                        if (typeof datatableKPDuTru != 'undefined') {
                            datatableKPDuTru.ajax.reload();
                        } else
                            initDatatableKPDuTru();
                        datatableKP.ajax.reload();
                    } else {
                        uppyDuTruEdit.removeFile(uppyDuTruEdit.getFiles().length == 0 ? '' : uppyDuTruEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPDuTru .uppy-list').html('');
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                    save_loader.stopLoading();
                },
                error: function (data) {
                    uppyDuTruEdit.removeFile(uppyDuTruEdit.getFiles().length == 0 ? '' : uppyDuTruEdit.getFiles()[0].id);
                    $('#kt_uppy_editKPDuTru .uppy-list').html('');
                    save_loader.stopLoading();
                },
                dataType: "json",
                processData: false,
                contentType: false
            });
        });
        $('#btn_edit_kpDieuChinh').click(function () {
            save_loader.startLoading();
            var object = {
                expense_category_id: id_edit_KPtypes,
                expense_category_name: $('#edit_noidung_kpDieuChinh').val(),
                expense_price: $('#edit_dongia_kpDieuChinh').val(),
                expense_quantity: $('#edit_soluong_kpDieuChinh').val(),
                total : 0,
                note: $('#edit_ghichu_kpDieuChinh').val(),
                link : ''
            };
            if (object.expense_category_name == '' || object.expense_price == '' || object.expense_quantity == '') {
                toastr.warning("Bạn chưa điền hết các trường thông tin.");
                save_loader.stopLoading();
                return false;
            }
            var obj = new FormData();
            obj.append('activity_office_id', id_edit_KP);
            obj.append('activity_name', $('#detail_name').val());
            obj.append('data', JSON.stringify(object));

            let files = uppyDieuChinhEdit.getFiles();
            if (files.length != 0) {
                obj.append('img', uppyDieuChinhEdit.getFiles()[0].data)
            } else {
                obj.append('img', null);
            }
            $.ajax({
                url: "@Url.Action("editExpenseDieuChinh", "DetailOfAcademicActivity")",
                data: obj,
                type: "POST",
                success: function (data) {
                    if (data != '') {
                        toastr.success('Chỉnh sửa kinh phí điều chỉnh thành công.');
                        uppyDieuChinhEdit.removeFile(uppyDieuChinhEdit.getFiles().length == 0 ? '' : uppyDieuChinhEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPDieuChinh .uppy-list').html('');
                        clearModal('#editModal_KPDieuChinh');
                        $('#editModal_KPDieuChinh').modal('hide');
                        if (typeof datatableKPDieuChinh != 'undefined') {
                            datatableKPDieuChinh.ajax.reload();
                        } else
                            initDatatableKPDieuChinh();
                        datatableKP.ajax.reload();
                    } else {
                        uppyDieuChinhEdit.removeFile(uppyDieuChinhEdit.getFiles().length == 0 ? '' : uppyDieuChinhEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPDieuChinh .uppy-list').html('');
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                    save_loader.stopLoading();
                },
                error: function (data) {
                    uppyDieuChinhEdit.removeFile(uppyDieuChinhEdit.getFiles().length == 0 ? '' : uppyDieuChinhEdit.getFiles()[0].id);
                    $('#kt_uppy_editKPDieuChinh .uppy-list').html('');
                    save_loader.stopLoading();
                },
                dataType: "json",
                processData: false,
                contentType: false
            });
        });
        $('#btn_edit_kpThucTe').click(function () {
            save_loader.startLoading();
            var object = {
                expense_category_id: id_edit_KPtypes,
                expense_category_name: $('#edit_noidung_kpThucTe').val(),
                expense_price: $('#edit_dongia_kpThucTe').val(),
                expense_quantity: $('#edit_soluong_kpThucTe').val(),
                total : 0,
                note: $('#edit_ghichu_kpThucTe').val(),
                link : ''
            };
            if (object.expense_category_name == '' || object.expense_price == '' || object.expense_quantity == '') {
                toastr.warning("Bạn chưa điền hết các trường thông tin.");
                save_loader.stopLoading();
                return false;
            }
            var obj = new FormData();
            obj.append('activity_office_id', id_edit_KP);
            obj.append('activity_name', $('#detail_name').val());
            obj.append('data', JSON.stringify(object));

            let files = uppyThucTeEdit.getFiles();
            if (files.length != 0) {
                obj.append('img', uppyThucTeEdit.getFiles()[0].data)
            } else {
                obj.append('img', null);
            }
            $.ajax({
                url: "@Url.Action("editExpenseThucTe", "DetailOfAcademicActivity")",
                data: obj,
                type: "POST",
                success: function (data) {
                    if (data != '') {
                        toastr.success('Chỉnh sửa kinh phí thực tế thành công.');
                        uppyThucTeEdit.removeFile(uppyThucTeEdit.getFiles().length == 0 ? '' : uppyThucTeEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPThucTe .uppy-list').html('');
                        clearModal('#editModal_KPThucTe');
                        $('#editModal_KPThucTe').modal('hide');
                        if (typeof datatableKPThucTe != 'undefined') {
                            datatableKPThucTe.ajax.reload();
                        } else
                            initDatatableKPThucTe();
                        datatableKP.ajax.reload();
                    } else {
                        uppyThucTeEdit.removeFile(uppyThucTeEdit.getFiles().length == 0 ? '' : uppyThucTeEdit.getFiles()[0].id);
                        $('#kt_uppy_editKPThucTe .uppy-list').html('');
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                    save_loader.stopLoading();
                },
                error: function (data) {
                    uppyThucTeEdit.removeFile(uppyThucTeEdit.getFiles().length == 0 ? '' : uppyThucTeEdit.getFiles()[0].id);
                    $('#kt_uppy_editKPThucTe .uppy-list').html('');
                    save_loader.stopLoading();
                },
                dataType: "json",
                processData: false,
                contentType: false
            });
        });
        var datatableGD = $("#GiaiDoanDatatable").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "",
                sSearch: ""
            },
            "searching": false,
            "lengthChange": false,
             ajax: {
                 url: "@Url.Action("getPhase", "DetailOfAcademicActivity")",
                 type: "POST",
                datatype: "json",
                 data: {
                     "language_id": function () { return document.getElementById('detail_language_content').value },
                     activity_id: document.getElementById('activity_id').value
                 },
                 cache: "false"
                },
            columns: [
                {
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "phase_name"
                },
                {
                    data: "from"
                },
                {
                    data: "to"
                },
                {
                    data: "full_name"
                },
                {
                    data: "phase_id",
                    title : "Hành động",
                    render: function (data, type, full, meta) {
                        return '<a href="javascript:;" class="btn btn-sm px-6 mr-3 btn-light-primary" onclick="editGiaiDoan(' + data +')">Sửa</a><a href="javascript:;" class="btn btn-sm btn-light-danger px-6" onclick="deleteGiaiDoan('+data+')">Xóa</a>';
                    }
                },
            ],
            columnDefs: [
                {
                    className: "text-center",
                    targets: '_all',
                },
                {
                    className: "text-nowrap",
                    targets: [-1]
                },
            ]
        });
        let datatableTC;
        function initDatatableTuCach() {
            datatableTC=  $("#TuCachDatatable").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "",
                sSearch: ""
            },
            "searching": false,
            "lengthChange": false,
             ajax: {
                 url: "@Url.Action("getParticipantRoleByPhase", "DetailOfAcademicActivity")",
                 type: "POST",
                 datatype: "json",
                 data: {
                     "phase_id": function () { return id_edit_giai_doan }
                 },
                 cache: "false"
                },
            columns: [
                {
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "participant_role_name"
                },
                {
                    data: "price",
                    render: function (data) {
                        if (data != null)
                            return data.toLocaleString('en');
                        else return 'Miễn phí';
                    }
                },
                {
                    data: "participant_role_id",
                    title : "Hành động",
                    render: function (data, type, full, meta) {
                        return '<a href="javascript:;" class="btn btn-sm px-6 mr-3 btn-light-primary" onclick="editTuCach(' + data +')">Sửa</a><a href="javascript:;" class="btn btn-sm btn-light-danger px-6" onclick="deleteTuCach('+data+')">Xóa</a>';
                    }
                },
            ],
            columnDefs: [
                {
                    className: "text-center",
                    targets: '_all',
                },
                {
                    className: "text-nowrap",
                    targets: [-1]
                },
            ]
            });
        }
        var DongTochucDatatable = $("#DongTochucDatatable").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "",
                sSearch: ""
            },
            "searching": false,
            "lengthChange": false,
             ajax: {
                 url: "@Url.Action("getDatatableDTC", "DetailOfAcademicActivity")",
                 type: "POST",
                 datatype: "json",
                 data: { activity_id: document.getElementById('activity_id').value },
                 cache: "false"
                },
            columns: [
                {
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "partner_name"
                },
                {
                    data: "from"
                },
                {
                    data: "to"
                },
                {
                    data: "contact_point",
                    render: function (data) {
                        if (data != "") {
                            var id = data.split('$')[0]
                            var name = data.split('$')[1]
                            return '<a href="javascript:;" onclick="viewContactPoint(' + id + ')">' + name + '</a>'
                        } else {
                            return data;
                        }
                    }
                },
                {
                    data: "sponsor",
                    render: function (data) {
                        return data != null ? data.toLocaleString('en') : null;
                    }
                },
                {
                    title : "Hành động",
                    render: function (data, type, row) {
                        return `<a href="#editModal_DongToChuc" class="btn btn-sm px-6 mr-3 btn-light-primary" data-id=`+ row.activity_partner_id +` data-toggle="modal">Sửa</a>
                                <a id="btn_delete_DongToChuc" class="btn btn-sm btn-light-danger px-6" data-id=`+ row.activity_partner_id+`>Xóa</a>`;
                    }
                },
            ],
            columnDefs: [
                {
                    className: "text-center",
                    targets: '_all',
                },
                {
                    className: "text-nowrap",
                    targets: [-1, -2]
                },
            ]
        });
        function viewContactPoint(id) {
            var object = {
                activity_partner_id : id
            }
            $.ajax({
                url: "@Url.Action("getContent", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    document.getElementById('contact_name').value = data.contact_point_name;
                    document.getElementById('contact_email').value = data.contact_point_email;
                    document.getElementById('contact_phone').value = data.contact_point_phone;
                    $('#viewContactModal').modal('show');
                },
                error: function (data) {
                    toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                }
            });
        }
        var datatableKP = $("#KinhPhiDatatable").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "",
                sSearch: ""
            },
            "searching": false,
            "lengthChange": false,
            ajax: {
                url: "@Url.Action("getDatatableKP", "DetailOfAcademicActivity")",
                type: "POST",
                datatype: "json",
                data: { activity_id: document.getElementById('activity_id').value },
                cache: "false"
            },
            columns: [
                {
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "office_name"
                },
                {
                    data: "cp_du_tru",
                    render: function (data) {
                        if (data != null)
                            return data.toLocaleString('en');
                        else {
                            return 0;
                        }
                    }
                },
                {
                    data: "cp_dieu_chinh",
                    render: function (data) {
                        if (data != null)
                            return data.toLocaleString('en');
                        else {
                            return 0;
                        }
                    }
                },
                {
                    data: "cp_thuc_te",
                    render: function (data) {
                        if (data != null)
                            return data.toLocaleString('en');
                        else {
                            return 0;
                        }
                    }
                },
                {
                    data: "chenh_lech",
                    render: function (data) {
                        if (data != null)
                            return data.toLocaleString('en');
                        else {
                            return 0;
                        }
                    }
                },
                {
                    data: "activity_office_id",
                    title: "Hành động",
                    render: function (data, type, full, meta) {
                        return '<div class="dropdown">' +
                            '<button class="btn btn-light-primary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Thao tác</button>' +
                            '<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">' +
                            '<a href="javascript:;" class="dropdown-item" onclick="KPDuTru(' + data + ')">KP dự trù</a>' +
                            '<a href="javascript:;" class="dropdown-item" onclick="KPDieuChinh(' + data + ')">KP điều chỉnh</a>' +
                            '<a href="javascript:;" class="dropdown-item" onclick="KPThucTe(' + data + ')">KP thực tế</a>' +
                            '<a href="javascript:;" class="dropdown-item" onclick="deleteKinhPhi(' + data + ')">Xóa</a>' +
                            '</div>' +
                            '</div>';
                    }
                }
            ],
            columnDefs: [
                {
                    className: "text-center",
                    targets: '_all',
                },
                {
                    className: "text-nowrap",
                    targets: [-1]
                },
            ]
        });
        let datatableKPDuTru;
        function initDatatableKPDuTru() {
            datatableKPDuTru = $("#KPDuTruDatatable").DataTable({
                oLanguage: {
                    oPaginate: {
                        sPrevious: "Trang trước",
                        sNext: "Trang sau"
                    },
                    sEmptyTable: "Không có dữ liệu",
                    sInfo: "",
                    sSearch: ""
                },
                "searching": false,
                "lengthChange": false,
                 ajax: {
                     url: "@Url.Action("getDatatableKPDuTru", "DetailOfAcademicActivity")",
                     type: "POST",
                     datatype: "json",
                     data: { activity_office_id: function () { return id_edit_KP } },
                     cache: "false"
                    },
                columns: [
                    {
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        data: "expense_category_name"
                    },
                    {
                        data: "expense_price",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "expense_quantity"
                    },
                    {
                        data: "total",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "note",
                    },
                    {
                        data: "expense_category_id",
                        title: "Hành động",
                        render: function (data, type, full, meta) {
                            return '<a href="javascript:;" class="btn btn-sm px-6 mr-3 btn-light-primary" onclick="editKinhPhiDuTru('+data+')">Sửa</a><a href="javascript:;" class="btn btn-sm btn-light-danger px-6" onclick="deleteKinhPhiDuTru('+data+')">Xóa</a>'
                        }
                    }
                ],
                columnDefs: [
                    {
                        className: "text-center",
                        targets: '_all',
                    },
                    {
                        className: "text-nowrap",
                        targets: [-1]
                    },
                ]
            });
        }
        let datatableKPDieuChinh;
        function initDatatableKPDieuChinh() {
            datatableKPDieuChinh = $("#KPDieuChinhDatatable").DataTable({
                oLanguage: {
                    oPaginate: {
                        sPrevious: "Trang trước",
                        sNext: "Trang sau"
                    },
                    sEmptyTable: "Không có dữ liệu",
                    sInfo: "",
                    sSearch: ""
                },
                "searching": false,
                "lengthChange": false,
                 ajax: {
                     url: "@Url.Action("getDatatableKPDieuChinh", "DetailOfAcademicActivity")",
                     type: "POST",
                     datatype: "json",
                     data: { activity_office_id: function () { return id_edit_KP } },
                     cache: "false"
                    },
                columns: [
                    {
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        data: "expense_category_name"
                    },
                    {
                        data: "price_bandau",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "sl_bandau"
                    },
                    {
                        data: "total_bandau",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "price_dieuchinh",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "sl_dieuchinh"
                    },
                    {
                        data: "total_dieuchinh",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "note",
                    },
                    {
                        data: "expense_category_id",
                        title: "Hành động",
                        render: function (data, type, full, meta) {
                            return '<a href="javascript:;" class="btn btn-sm px-6 mr-3 btn-light-primary" onclick="editKinhPhiDieuChinh('+data+')">Sửa</a><a href="javascript:;" class="btn btn-sm btn-light-danger px-6" onclick="deleteKinhPhiDieuChinh('+data+')">Xóa</a>'
                        }
                    }
                ],
                columnDefs: [
                    {
                        className: "text-center",
                        targets: '_all',
                    },
                    {
                        className: "text-nowrap",
                        targets: [-1]
                    },
                ]
            });
        }
        let datatableKPThucTe;
        function initDatatableKPThucTe() {
            datatableKPThucTe = $("#KPThucTeDatatable").DataTable({
                oLanguage: {
                    oPaginate: {
                        sPrevious: "Trang trước",
                        sNext: "Trang sau"
                    },
                    sEmptyTable: "Không có dữ liệu",
                    sInfo: "",
                    sSearch: ""
                },
                "searching": false,
                "lengthChange": false,
                 ajax: {
                     url: "@Url.Action("getDatatableKPThucTe", "DetailOfAcademicActivity")",
                     type: "POST",
                     datatype: "json",
                     data: { activity_office_id: function () { return id_edit_KP } },
                     cache: "false"
                    },
                columns: [
                    {
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        data: "expense_category_name"
                    },
                    {
                        data: "price_bandau",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "sl_bandau"
                    },
                    {
                        data: "total_bandau",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "price_dieuchinh",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "sl_dieuchinh"
                    },
                    {
                        data: "total_dieuchinh",
                        render: function (data) {
                            if (data != null)
                                return data.toLocaleString('en');
                            else {
                                return 0;
                            }
                        }
                    },
                    {
                        data: "note",
                    },
                    {
                        data: "expense_category_id",
                        title: "Hành động",
                        render: function (data, type, full, meta) {
                            return '<a href="javascript:;" class="btn btn-sm px-6 mr-3 btn-light-primary" onclick="editKinhPhiThucTe('+data+')">Sửa</a><a href="javascript:;" class="btn btn-sm btn-light-danger px-6" onclick="deleteKinhPhiThucTe('+data+')">Xóa</a>'
                        }
                    }
                ],
                columnDefs: [
                    {
                        className: "text-center",
                        targets: '_all',
                    },
                    {
                        className: "text-nowrap",
                        targets: [-1]
                    },
                ]
            });
        }
        $("#ThongKeSLDatatable").DataTable({
            oLanguage: {
                oPaginate: {
                    sPrevious: "Trang trước",
                    sNext: "Trang sau"
                },
                sEmptyTable: "Không có dữ liệu",
                sInfo: "",
                sSearch: ""
            },
            "searching": false,
            "lengthChange": false,
            columnDefs: [
                {
                    targets: [0, 1, 2],
                    className: "text-center",
                },
                {
                    targets: [0],
                    className: "text-center",
                    visible: false
                }
            ]
        });
        var KTBootstrapDatetimepicker = function () {
            var baseDemos = function () {
                $('.kt_datetimepicker_3').datetimepicker({
                    format: 'DD/MM/YYYY'
                });
            }
            return {
                init: function () {
                    baseDemos();
                }
            };
        }();
        $('#add_name_phamvihoptac').select2({
            placeholder: 'Phạm vi hợp tác',
            allowClear: true
        });
        $('#add_name_donvi').select2({
            placeholder: 'Tên đơn vị',
            allowClear: true
        });
        $('#add_name_donvitiente').select2({
            placeholder: 'Đơn vị tiền tệ',
            allowClear: true
        });
        function initDetail() {
            arrIndexContent.forEach(function (x) {
                $('#row-ckeditor-' + x).remove();
            });
            arrIndexContent = [];
            numberOfIndexContent = 0;
            var object = {
                language_id: document.getElementById('detail_language_content').value,
                activity_id: document.getElementById('activity_id').value
            }
            $.ajax({
                url: "@Url.Action("getDetail", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data.baseDetail.article_status_id == 2) {
                        $('#remove_activity').attr('hidden', false);
                    } else {
                        $('#post_activity').attr('hidden', false);
                    }
                    document.getElementById('detail_name').value = data.baseDetail.activity_name;
                    document.getElementById('detail_location').value = data.baseDetail.location;
                    if (document.getElementById('detail_name').value != '') {
                        document.getElementById('detail_from').value = data.baseDetail.from;
                        document.getElementById('detail_to').value = data.baseDetail.to;
                    }
                    $('#editor-main-content').summernote('code', data.baseDetail.article_content);
                    data.subContent.forEach(function (x) {
                        bonusRowContent(x.article_id);
                        $('#editor-subcontent-' + x.article_id).summernote('code', x.article_content);
                        document.getElementById('content-' + x.article_id).value = x.version_title;
                    });
                    $('#detail_category').empty();
                    data.types.forEach(function (x) {
                        $('#detail_category').append('<option value=' + x.activity_type_id + '>' + x.activity_type_name+'</option>');
                    });
                    document.getElementById('detail_category').value = data.baseDetail.activity_type_id;
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }
        $('#btn_detail').click(function () {
            var listSub = [];
            var language_id = document.getElementById('detail_language_content').value;
            var item = {
                activity_id: document.getElementById('activity_id').value,
                activity_name: document.getElementById('detail_name').value,
                activity_type_id: document.getElementById('detail_category').value,
                location: document.getElementById('detail_location').value,
                from: document.getElementById('detail_from').value,
                to: document.getElementById('detail_to').value,
                language_id: language_id,
                article_content: $('#editor-main-content').summernote('code'),
                article_status_id: 1,
            };
            if (item.activity_name == '' || item.location == '' || item.article_content == '') {
                toastr.warning("Bạn chưa điền hết các trường thông tin.");
                return false;
            }
            let check = false;
            arrIndexContent.forEach(function (x) {
                var obj = {
                    article_id: x,
                    version_title: document.getElementById('content-' + x).value,
                    article_content: $('#editor-subcontent-' + x).summernote('code'),
                    language_id: language_id
                }
                if (obj.version_title == '' || obj.article_content == '') {
                    check = true;
                }
                listSub.push(obj);
            });
            if (check) {
                toastr.warning("Nội dung đề mục không thể để trống.");
                return false;
            }
            if (convertDate(item.from).getTime() > convertDate(item.to).getTime()) {
                toastr.warning("Thời hạn bắt đầu không thể sau thời hạn kết thúc");
                return false;
            }
            var object = {
                infoDetail: item,
                subContent: listSub
            };
            $.ajax({
                url: "@Url.Action("updateDetail", "DetailOfAcademicActivity")",
                data: JSON.stringify(object),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        toastr.success(data);
                    } else {
                        toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                    }
                },
                error: function (data) {
                    toastr.error('Có lỗi xảy ra. Vui lòng thử lại');
                }
            });
        });
        function reInit() {
            initDetail();
            datatableGD.ajax.reload();
        }
        let arrOffice = [];
        function getOffice() {
            $.ajax({
                url: "@Url.Action("getOffice", "DetailOfAcademicActivity")",
                data: {},
                type: "POST",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    arrOffice = data;
                }
            });
        }
        function genOffice(id) {
            let html = '';
            arrOffice.forEach(function (x) {
                html += '<option value="' + x.office_id + '">' + x.office_name + '</option>';
            });
            $(id).append(html);
        }

        $(document).ready(function () {
            $('#add_control_title').hide();
            $('#add_control_btn').hide();
            $('#add_control_price').hide();
            KTBootstrapDatetimepicker.init();
        });
        jQuery(document).ready(function () {
            initDetail();
            KTSummernoteDemo.init();
            getOffice();
        });
    </script>
    <script src="~/Content/Custom JS/InternationalCollaboration/AcademicActivity/uppy.js"></script>
}
