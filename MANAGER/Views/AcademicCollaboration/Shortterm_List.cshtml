@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .collapse-title {
        width: auto;
        height: auto;
    }

    .collapse-div {
        background-color: #1616a8;
        border-radius: 6px;
        color: white;
        opacity: 0.6;
        transition: 0.3s;
    }

        .collapse-div:hover {
            opacity: 1;
        }

    .modal {
        overflow-y: auto;
    }

    .uppy-list-item {
        margin: 0 !important;
    }

    .select2-dropdown {
        z-index: 8888;
    }

    .label-lg {
        width: 77% !important;
    }
</style>
<div class="row mb-5">
    <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
        <a href="javascript:;" class="" id="edit_content_short_term">Chỉnh sửa nội dung miêu tả</a>
    </div>
</div>
<div class="card card-custom mb-1 collapse-title" id="collapse-title">
    <div class="card-body p-0 collapse-div">
        <div class="row justify-content-center px-lg-10">
            <div class=" col-lg-12 col-xl-12 col-md-12 col-sm-12 text-center " id="collapse_btn_tab_1">
                <h3 style="margin-top: 0.5rem;">
                    CHIỀU ĐI
                </h3>
            </div>
        </div>
    </div>
</div>
<div class="card card-custom collapse_tab_1" id="main-card">
    <div class="card-body p-0 ">
        <div class="row justify-content-center px-8 my-lg-5 px-lg-10">
        </div>
        <div class="row justify-content-center px-8 my-lg-5 px-lg-10">
            <div class="col-xl-12 col-xxl-12">
                <div class="tabbable-line">
                    <div class="row">
                        <ul class="nav nav-tabs nav-tabs-line col-8">
                            <li class="nav-item ">
                                <a class="nav-link active" data-toggle="tab" href="#kt_tab_pane_1_table_1">CÁN BỘ GIẢNG VIÊN</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_2_table_1">THỦ TỤC</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_3_table_1">CHƯƠNG TRÌNH TRAO ĐỔI</a>
                            </li>
                        </ul>
                        <ul class="nav nav-tabs nav-tabs-line col-4 justify-content-end" style="padding-right: 0">
                            <li class="nav-item">
                                <a href="javascript:;" class="nav-link" id="edit_content_going">Chỉnh sửa nội dung miêu tả</a>
                            </li>
                        </ul>
                    </div>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="kt_tab_pane_1_table_1" role="tabpanel" aria-labelledby="kt_tab_pane_1_table_1">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    CÁN BỘ GIẢNG VIÊN
                                </h4>
                            </div>

                            @{
                                Html.RenderPartial("PartialView/Short_Term_Exchange_Going_Table");
                            }
                        </div>
                        <div class="tab-pane fade" id="kt_tab_pane_2_table_1" role="tabpanel" aria-labelledby="kt_tab_pane_2_table_1">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    THỦ TỤC
                                </h4>
                            </div>
                            @{
                                Html.RenderPartial("PartialView/Short_Term_Procedure_Going_Table");
                            }
                        </div>
                        <div class="tab-pane fade" id="kt_tab_pane_3_table_1" role="tabpanel" aria-labelledby="kt_tab_pane_3_table_1">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    CHƯƠNG TRÌNH ĐÀO TẠO
                                </h4>
                            </div>
                            @{
                                Html.RenderPartial("PartialView/Short_Term_Program_Going_Table");
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card card-custom mb-1 collapse-title" id="collapse-title" style="margin-top: 20px;">
    <div class="card-body p-0 collapse-div">
        <div class="row justify-content-center px-lg-10">
            <div class=" col-lg-12 col-xl-12 col-md-12 col-sm-12 text-center " id="collapse_btn_tab_2">
                <h3 style="margin-top: 0.5rem;">
                    CHIỀU ĐẾN
                </h3>
            </div>
        </div>
    </div>
</div>
<div class="card card-custom collapse_tab_2" style="display:none">
    <div class="card-body p-0">
        <div class="row justify-content-center px-8 my-lg-5 px-lg-10">
            <div class="col-xl-12 col-xxl-12">
                <div class="tabbable-line">
                    <div class="row">
                        <ul class="nav nav-tabs nav-tabs-line col-8">
                            <li class="nav-item ">
                                <a class="nav-link active" data-toggle="tab" href="#kt_tab_pane_1_table_2">CÁN BỘ GIẢNG VIÊN</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_2_table_2">THỦ TỤC</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#kt_tab_pane_3_table_2">CHƯƠNG TRÌNH TRAO ĐỔI</a>
                            </li>
                        </ul>
                        <ul class="nav nav-tabs nav-tabs-line col-4 justify-content-end" style="padding-right: 0">
                            <li class="nav-item">
                                <a href="javascript:;" class="nav-link" id="edit_content_coming">Chỉnh sửa nội dung miêu tả</a>
                            </li>
                        </ul>
                    </div>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="kt_tab_pane_1_table_2" role="tabpanel" aria-labelledby="kt_tab_pane_1_table_2">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    CÁN BỘ GIẢNG VIÊN
                                </h4>
                            </div>
                            @{
                                Html.RenderPartial("PartialView/Short_Term_Exchange_Coming_Table");
                            }
                        </div>
                        <div class="tab-pane fade" id="kt_tab_pane_2_table_2" role="tabpanel" aria-labelledby="kt_tab_pane_2_table_2">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    THỦ TỤC
                                </h4>
                            </div>
                            @{
                                Html.RenderPartial("PartialView/Short_Term_Procedure_Coming_Table");
                            }
                        </div>
                        <div class="tab-pane fade" id="kt_tab_pane_3_table_2" role="tabpanel" aria-labelledby="kt_tab_pane_3_table_2">
                            <div class="row mb-4">
                                <h4 style="font-weight: bold;">
                                    CHƯƠNG TRÌNH ĐÀO TẠO
                                </h4>
                            </div>
                            @{
                                Html.RenderPartial("PartialView/Short_Term_Program_Coming_Table");
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*modal description*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Description");
}

@*modal add status*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Add_Status_History");
}

@*modal status hisory*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_View_Status_History");
}

@*modal add officer*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Add_Officer");
}

@*modal edit officer*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Edit_Officer");
}

@*modal add procedure*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Add_Procedure");
}

@*modal edit procedure*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Edit_Procedure");
}

@*modal add program*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Add_Program");
}

@*modal edit program*@
@{
    Html.RenderPartial("PartialView/Short_Term_Modal_Edit_Program");
}



@section scripts{
    <link href="~/Content/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" />
    <script src="~/Content/assets/plugins/custom/datatables/datatables.bundle.js"></script>

    @*-------------------datatable check this file-------------*@
    <script src="~/Scripts/Custom_JS/InternationalCollaboration/AcademicCollaboration/ShortTerm_Datatable.js"></script>
    @*-------------------datatable check this file-------------*@
    <script src="~/Scripts/Custom_JS/InternationalCollaboration/AcademicCollaboration/ProcedureContentProcessing.js"></script>
    @*--------------init datepicker and rangepicker-----------*@
    <script src="~/Scripts/Custom_JS/InternationalCollaboration/kt_datetimepicker_3_and_range.js"></script>
    @*--------------init datepicker and rangepicker-----------------*@

    <script>
        //delete procedure======================================================================
        function confirm_delete_procedure(article_id) {
            var id = { article_id: article_id }
            Swal.fire({
                title: "Xác nhận xóa",
                text: "Có muốn xóa bản ghi này",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Xóa",
                cancelButtonText: "Hủy",
                reverseButtons: true
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: '/AcademicCollaboration/DeleteProcedure',
                        type: "POST",
                        dataType: 'json',
                        data: id,
                        success: function (data) {
                            if (data.success) {
                                $('#procedure_going_table').DataTable().ajax.reload()
                                $('#procedure_coming_table').DataTable().ajax.reload()
                                Swal.fire("Thành công", "Xóa thành công", "success");
                            } else {
                                Swal.fire("Thất bại", "Có lỗi khi xóa", "error");
                            }
                        },
                        error: function () {
                            Swal.fire("Thất bại", "Có lỗi khi xóa", "error");
                        },
                    })
                }
            })
        };
        //delete procedure======================================================================
    </script>
    <script>
        //load edit procedure===================================================================
        var procedure_id_load_language;
        function load_procedure_detail(procedure_id) {
            procedure_id_load_language = procedure_id
            var id = { procedure_id: procedure_id }
            $.ajax({
                url: '/AcademicCollaboration/LoadEdit',
                type: 'post',
                dataType: 'json',
                data: id,
                success: function (data) {
                    $('#edit_procedure_title').val(data.json.procedure_name)
                    $('#edit_summernote').summernote('code', data.json.content)
                    $('#edit_procedure_language').val(data.json.language_id).trigger('change')
                    $("#edit_procedure").modal("show")
                }
            })
        }
        //load edit procedure===================================================================
        //change select 2 load language=========================================================
        $('#edit_procedure_language').select2({
            placeholder: 'Ngôn ngữ',
        }).on('select2:select', function () {
            $.ajax({
                url: '@Url.Action("LoadContentDetailLanguage", "AcademicCollaboration")',
                type: "POST",
                data:{
                "procedure_id": procedure_id_load_language,
                "language_id": $('#edit_procedure_language').val()
                },
                success: function (data) {
                    $('#edit_summernote').summernote('code', data.content)
                },
                error: function () {
                }
            })
        })
        //change select 2 load language=========================================================
        //save edit=============================================================================

        function dataURItoBlob(dataURI) {
            var blobBin = atob(dataURI.split(',')[1]);
            var array = [];
            for (var i = 0; i < blobBin.length; i++) {
                array.push(blobBin.charCodeAt(i));
            }
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var file = new Blob([new Uint8Array(array)], { type: mimeString });
            return file;
        }

        var save_loader = new LoaderBtn($(".load-btn"))
        $('#submit').click(function () {
            var id = @ViewBag.partnerArticle.partner_id;
            var form_data = new FormData();

            var edit_procedure_title = $('#edit_procedure_title').val()
            var edit_procedure_language = $('#edit_procedure_language').val()

            if (edit_procedure_title == "") {
                toastr.warning("Vui lòng nhập tiêu đề")
                return;
            }
            var content = $('#edit_summernote').summernote('code') + "";

            var list_image = $('.note-editor').find('img')
            var count_upload = 0;
            if (list_image.length != 0) {
                for (i = 0; i < list_image.length; i++) {
                    var temp = list_image[i];
                    var temp_src = $(temp).attr('src') + "";
                    if (temp_src.includes('data:')) {
                        count_upload++
                        content = content.replace(temp_src, 'image_' + i)
                        form_data.append('image_' + i, dataURItoBlob(temp_src))
                    }
                }
            }

            form_data.append("numberOfImage", count_upload)
            form_data.append('edit_procedure_title', edit_procedure_title)
            form_data.append('edit_procedure_language', edit_procedure_language)
            form_data.append('content', content)

            save_loader.startLoading();
            $.ajax({
                url: "/Partner/Save_Edit",
                method: "post",
                dataType: "json",
                data: form_data,
                processData: false,
                contentType: false,
                success: function (data) {
                    if (data.success) {
                        toastr.options.onHidden = function () {
                            window.location.href = '@Url.Action("List", "Partner")';
                        }
                        toastr.clear()
                        toastr.success('Thêm thành công<br />Ấn để quay lại danh sách<br />');
                        save_loader.stopLoading()
                    } else {
                        toastr.clear()
                        toastr.warning(data.content);
                        save_loader.stopLoading()
                    }
                },
                error: function () {
                    toastr.clear();
                    toastr.error('Có lỗi xảy ra khi thêm');
                    save_loader.stopLoading()
                }
            });
        })
        //save edit=============================================================================
    </script>
    <script>
        $('#edit_content_short_term').click(function () {
            $('#describe_content').find("textarea").val('').end()
            $('#describe_content').modal('show');
        })

        $('#edit_content_going').click(function () {
            $('#describe_content').find("textarea").val('').end()
            $('#describe_content').modal('show');
        })

        $('#edit_content_coming').click(function () {
            $('#describe_content').find("textarea").val('').end()
            $('#describe_content').modal('show');
        })

    </script>
    <script>
        //select2 officer going
        $('#search_nation_tab_1_table_1').select2({
            placeholder: 'Quốc gia',
            allowClear: true,
            tags: true,
        })

        $('#search_year_tab_1_table_1').select2({
            placeholder: 'Năm đi học',
            allowClear: true,
            tags: true,
        })

        $('#search_training_facility_tab_1_table_1').select2({
            placeholder: 'Đơn vị đào tạo',
            allowClear: true,
            tags: true,
        })

        $('#search_working_facility_tab_1_table_1').select2({
            placeholder: 'Đơn vị công tác',
            allowClear: true,
            tags: true,
        })

        //select modal table 1
        $('#add_officer_name').select2({
            placeholder: 'Họ và tên',
            allowClear: true,
            tags: true,
        })
        $('#add_officer_facility').select2({
            placeholder: 'Đơn vị - Cơ sở',
            allowClear: true,
            tags: true,
        })
        $('#add_officer_traning').select2({
            placeholder: 'Đơn vị đào tạo',
            allowClear: true,
            tags: true,
        })
        $('#add_officer_coop_scope').select2({
            placeholder: 'Phạm vi hợp tác',
            allowClear: true,
            tags: true,
        })
        $('#add_officer_status').select2({
            placeholder: 'Trạng thái',
            allowClear: true,
            tags: true,
        })
    </script>
    <script>
        //select2 officer coming

        $('#search_nation_tab_1_table_2').select2({
            placeholder: 'Quốc gia',
            allowClear: true,
            tags: true,
        })

        $('#search_year_tab_1_table_2').select2({
            placeholder: 'Năm đi học',
            allowClear: true,
            tags: true,
        })

        $('#search_training_facility_tab_1_table_2').select2({
            placeholder: 'Đơn vị đào tạo',
            allowClear: true,
            tags: true,
        })

        $('#search_working_facility_tab_1_table_2').select2({
            placeholder: 'Đơn vị công tác',
            allowClear: true,
            tags: true,
        })
    </script>
    <script>
    </script>
    <script>
        //table 3
        $('#search_status_tab_2_table_1').select2({
            placeholder: 'Trạng thái',
            allowClear: true,
            tags: true,
        })

        $('#add_program_partner').select2({
            placeholder: 'Đối tác',
            allowClear: true,
            tags: true,
        })

        $('#add_program_language').select2({
            placeholder: 'Ngôn ngữ',
            allowClear: true,
            tags: true,
        })

    </script>
    <script>
        //table 4
        $('#search_status_tab_2_table_2').select2({
            placeholder: 'Trạng thái',
            allowClear: true,
            tags: true,
        })
    </script>
    <script>
        //collapse div
        $('#collapse_btn_tab_1').click(function () {
            $('.collapse_tab_1').toggle(700)
        });

        $('#collapse_btn_tab_2').click(function () {
            $('.collapse_tab_2').toggle(700)
        })

        $('#collapse_btn_tab_2').on('click', function (e) {
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
        });

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
        });
        //split card
        //overflow
        $(document).ready(function () {
            $('#main-card').parent().css("background-color", "#eef0f8");
            //$('.collaboration_table thead tr th').css('font-weight', 'bold');
            $('.header-modify').css('padding', '13px');
        });

        //load status history table
        function show_status_history(id){
            $.ajax({
                url: '@Url.Action("Get_Status_History", "AcademicCollaboration")',
                data: { 'id': id },
                success: function (data) {
                    if (data = "") {
                        toastr.error("Có lỗi xảy ra");
                    } else {
                        var status = {
                            1: {
                                'title': 'Không hoàn thành',
                                'class': 'label-secondary'
                            },
                            2: {
                                'title': 'Đã hoàn thành',
                                'class': 'label-success'
                            },
                            3: {
                                'title': 'Đang thực hiện',
                                'class': 'label-danger'
                            }
                        };
                        var temp = '';
                        for (i = 0; i < 3; i++) {
                            temp += '<tr><td  class="text-center">' + eval(i+1) + '</td> ' +
                                '<td class="text-center">01/01/2021 12:10:11</td> ' +
                                '<td class="text-center"> ' +
                                '<span class="label label-lg label-pill font-weight-bold ' + status[eval(i+1)].class +
                                ' label-inline">' + status[eval(i + 1)].title + '</span></td> ' +
                                '<td class="text-center">Lê Phương Anh</td> ' +
                                '<td class="text-center">abc.pdf</td>' +
                                '<td class="text-center">Đã học xong</td></tr>';
                        }
                        $('#status_history_table').html(temp);
                    }
                },
            });
        };

    </script>

    @*text editor*@
    <script>
        var KTSummernoteDemo = function () {
            // Private functions
            var demos = function () {
                $('.summernote').summernote({
                    height: 400,
                    tabsize: 2
                });
            }

            return {
                // public functions
                init: function () {
                    demos();
                }
            };
        }();

        // Initialization
        jQuery(document).ready(function () {
            KTSummernoteDemo.init();
        });
    </script>

    @*upload*@
    <script src="~/Content/assets/plugins/custom/uppy/uppy.bundle.js?v=7.0.6"></script>
    <script src="~/Scripts/Custom_JS/InternationalCollaboration/uppy.js"></script>
    <script src="~/Scripts/Custom_JS/InternationalCollaboration/uppy.js"></script>
}



